<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: "Vilela Esportiva" - Inspirada nos logos da prefeitura (azul marinho, verde-lim√£o) e neutros (branco, cinza claro) para criar uma identidade visual moderna, tecnol√≥gica e ligada ao munic√≠pio. -->
    <!-- Application Structure Plan: A estrutura foi desenhada para priorizar a usabilidade e o acesso r√°pido √† informa√ß√£o, em vez de espelhar a ordem linear do regulamento. A p√°gina √© dividida em se√ß√µes tem√°ticas: 1. Vis√£o Geral (Hero) com um contador regressivo para engajamento e dados chave (datas, modalidades). 2. Modalidades com filtros interativos por categoria, o que √© mais √∫til para t√©cnicos e atletas. 3. Prazos e Inscri√ß√µes em formato de linha do tempo visual. 4. Pontua√ß√£o e Premia√ß√£o, para detalhar os novos sistemas. 5. Regras Essenciais organizadas em um acorde√£o para evitar um bloco de texto massivo. Essa arquitetura orientada √† tarefa facilita a navega√ß√£o e a consulta r√°pida, que s√£o os principais objetivos dos usu√°rios deste tipo de documento. -->
    <!-- Visualization & Content Choices: 1. (Informar) Contador Regressivo: HTML/CSS/JS para criar urg√™ncia e engajamento. 2. (Comparar) Gr√°fico de Modalidades por Categoria: Chart.js (Canvas) para mostrar visualmente a distribui√ß√£o de esportes, facilitando a compreens√£o da oferta. 3. (Organizar) Filtro de Modalidades: HTML/CSS/JS para permitir que os usu√°rios vejam apenas os esportes de seu interesse, melhorando a usabilidade. 4. (Organizar) Linha do Tempo de Prazos: HTML/CSS para apresentar datas cr√≠ticas de forma mais visual e f√°cil de seguir. 5. (Organizar) Acorde√£o de Regras: HTML/CSS/JS para agrupar regras complexas em t√≥picos clic√°veis, tornando a informa√ß√£o menos intimidante. 6. (Gerar Conte√∫do Espec√≠fico) Plano de Treinamento/Regras e Hist√≥rico por Modalidade: Chamada √† API Gemini para gerar conte√∫do detalhado ao clicar em uma modalidade. 7. (Orientar/Apoiar) Dicas de Treino e Alimenta√ß√£o: Chamada √† API Gemini para gerar conselhos pr√°ticos para esportes espec√≠ficos. 8. (Aprofundar) Explicar Regra em Detalhe: Chamada √† API Gemini para fornecer explica√ß√µes aprofundadas de regras. 9. (Detalhar Modalidade) Visualizar Detalhes da Modalidade: Ao clicar no card da modalidade, um modal exibe informa√ß√µes est√°ticas e uma descri√ß√£o gerada por IA. Justificativa: todas as escolhas visam transformar um documento denso em uma ferramenta de consulta r√°pida e interativa, adicionando valor com IA generativa e contextualizada para os p√∫blicos-alvo. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>JEV'S 2025 - Regulamento Interativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            overflow-x: hidden; /* Previne rolagem horizontal */
        }
        .brand-gradient {
            background: linear-gradient(90deg, #1e3a8a, #4f46e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%; /* Responsivo para telas pequenas */
            max-width: 400px; /* Limite para telas maiores */
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }
        .tab-btn.active {
            background-color: #1e3a8a; /* bg-blue-800 */
            color: white;
        }
        .principle-wheel {
            display: grid;
            grid-template-areas: "a b" "d c";
            gap: 1rem;
            max-width: 500px;
            margin: auto;
        }
        .principle-slice {
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .principle-slice:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .principle-slice:nth-child(1) { grid-area: a; background-color: #bfdbfe; border-top-left-radius: 100%; }
        .principle-slice:nth-child(2) { grid-area: b; background-color: #bbf7d0; border-top-right-radius: 100%; }
        .principle-slice:nth-child(3) { grid-area: c; background-color: #fef08a; border-bottom-right-radius: 100%; }
        .principle-slice:nth-child(4) { grid-area: d; background-color: #fecaca; border-bottom-left-radius: 100%; }
        .card-icon {
            margin-bottom: 0.75rem; /* 12px */
            height: 56px; /* Garante altura consistente */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-icon img {
            max-height: 56px;
            width: auto;
        }
    </style>
</head>
<body class="text-slate-700">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-blue-800 rounded-full flex items-center justify-center text-white font-bold text-lg">
                    J
                </div>
                <span class="text-xl font-bold text-slate-800">JEV'S 2025</span>
            </a>
            <!-- Desktop Menu Wrapper -->
            <div id="desktop-menu-wrapper" class="hidden md:flex items-center space-x-8">
                <div id="main-nav" class="flex items-center space-x-8">
                    <a href="#overview" class="hover:text-blue-700 transition">Vis√£o Geral</a>
                    <a href="#modalities" class="hover:text-blue-700 transition">Modalidades</a>
                    <a href="#timeline" class="hover:text-blue-700 transition">Prazos</a>
                    <a href="#scoring" class="hover:text-blue-700 transition">Pontua√ß√£o</a>
                    <a href="#rules" class="hover:text-blue-700 transition">Regras</a>
                </div>
                <a id="cta-button" href="links.html" class="bg-blue-700 text-white px-5 py-2 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20">
                    Inscreva-se
                </a>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#overview" class="block py-2 hover:text-blue-700">Vis√£o Geral</a>
            <a href="#modalities" class="block py-2 hover:text-blue-700">Modalidades</a>
            <a href="#timeline" class="block py-2 hover:text-blue-700">Prazos</a>
            <a href="#scoring" class="block py-2 hover:text-blue-700">Pontua√ß√£o</a>
            <a href="#rules" class="block py-2 hover:text-blue-700">Regras</a>
            <a href="links.html" class="block mt-2 bg-blue-700 text-white text-center px-5 py-2 rounded-full hover:bg-blue-800 transition">
                Inscreva-se
            </a>
        </div>
    </header>

    <div class="container mx-auto px-6">
        <section id="profile-selector" class="py-20 text-center">
            <h2 class="text-3xl font-bold text-slate-800 mb-4">Bem-vindo(a) ao Portal JEV'S 2025!</h2>
            <p class="text-lg text-slate-600 max-w-2xl mx-auto mb-8">Para uma experi√™ncia personalizada, por favor, identifique seu perfil.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-4">
                <button data-profile="teacher" class="profile-btn w-full md:w-auto bg-blue-700 text-white px-6 py-3 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20">
                    üë®‚Äçüè´ Sou Professor/T√©cnico
                </button>
                <button data-profile="organizer" class="profile-btn w-full md:w-auto bg-green-600 text-white px-6 py-3 rounded-full hover:bg-green-700 transition shadow-lg shadow-green-600/20">
                    üìã Sou Organizador/Coordenador
                </button>
                <button data-profile="student" class="profile-btn w-full md:w-auto bg-indigo-600 text-white px-6 py-3 rounded-full hover:bg-indigo-700 transition shadow-lg shadow-indigo-600/20">
                    üèÉ‚Äç‚ôÇÔ∏è Sou Estudante Atleta
                </button>
            </div>
        </section>
    </div>

    <!-- Main content area that will be populated based on profile -->
    <div id="content-wrapper" class="hidden">
        <div class="container mx-auto px-6 text-right my-4">
            <button id="switch-profile-btn" class="text-sm text-blue-700 hover:underline font-semibold">‚Üê Trocar Perfil</button>
        </div>
        <div id="main-content">
            <!-- Profile-specific content will be injected here -->
        </div>
    </div>

    <!-- Organizer Login Modal -->
    <div id="organizer-login-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-login-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">Acesso Restrito</h3>
            <form id="organizer-login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-slate-700 mb-1">Usu√°rio</label>
                    <input type="text" id="username" name="username" required class="w-full p-3 border border-slate-300 rounded-lg bg-white text-slate-700 focus:ring-green-500 focus:border-green-500">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-slate-700 mb-1">Senha</label>
                    <input type="password" id="password" name="password" required class="w-full p-3 border border-slate-300 rounded-lg bg-white text-slate-700 focus:ring-green-500 focus:border-green-500">
                </div>
                <p id="login-error" class="text-red-500 text-sm text-center mb-4"></p>
                <button type="submit" class="w-full bg-green-600 text-white px-6 py-3 rounded-full hover:bg-green-700 transition flex items-center justify-center">
                    <span id="login-btn-text">Entrar</span>
                    <svg id="login-loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>


    <!-- Teacher/Coach View Template -->
    <template id="teacher-view-template">
        <main class="container mx-auto px-6">
            <section class="my-8">
                <div class="bg-slate-100 border-l-4 border-slate-500 text-slate-800 p-4 rounded-lg shadow-lg" role="alert">
                    <div class="flex">
                        <div class="py-1"><svg class="fill-current h-6 w-6 text-slate-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg></div>
                        <div>
                            <p class="font-bold">Inscri√ß√µes Encerradas</p>
                            <p class="text-sm">O per√≠odo de inscri√ß√µes para o JEV'S 2025 foi finalizado. Aguarde o Congresso T√©cnico.</p>
                        </div>
                    </div>
                </div>
            </section>
            <section id="overview" class="py-20 md:py-28 text-center">
                <h1 class="text-4xl md:text-6xl font-black mb-4"><span class="brand-gradient">Jogos Estudantis Vilelenses</span> 2025</h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto mb-8">O maior evento de esporte escolar de Teot√¥nio Vilela est√° chegando! Prepare sua equipe para a XV Edi√ß√£o dos jogos.</p>
                <div id="countdown" class="flex justify-center space-x-4 md:space-x-8 text-center my-12">
                    <div><div id="days" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div><div class="text-sm font-semibold text-slate-500 mt-2">DIAS</div></div>
                    <div><div id="hours" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div><div class="text-sm font-semibold text-slate-500 mt-2">HORAS</div></div>
                    <div><div id="minutes" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div><div class="text-sm font-semibold text-slate-500 mt-2">MINUTOS</div></div>
                    <div><div id="seconds" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div><div class="text-sm font-semibold text-slate-500 mt-2">SEGUNDOS</div></div>
                </div>
                <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto text-left mt-16">
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100"><h3 class="font-bold text-lg text-slate-800 mb-2">üóìÔ∏è Datas do Evento</h3><p class="text-slate-600">01 a 10 de Setembro de 2025</p></div>
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100"><h3 class="font-bold text-lg text-slate-800 mb-2">üèÜ Modalidades</h3><p class="text-slate-600">15 modalidades coletivas e individuais.</p></div>
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100"><h3 class="font-bold text-lg text-slate-800 mb-2">üìç Local Principal</h3><p class="text-slate-600">Gin√°sio Poliesportivo "O Senadinho" e outros locais a definir.</p></div>
                </div>
            </section>
            <section class="py-10">
                <div class="max-w-4xl mx-auto">
                    <a href="regulamentos.html" class="block bg-white p-8 rounded-2xl shadow-lg border border-slate-100 hover:shadow-xl hover:-translate-y-1 transition-transform duration-300">
                        <div class="flex items-center">
                            <div class="text-5xl mr-6">‚öñÔ∏è</div>
                            <div>
                                <h3 class="text-2xl font-bold text-slate-800 text-left">P√°gina de Regulamentos</h3>
                                <p class="text-slate-600 text-left">Acesse a p√°gina com os links para todos os regulamentos espec√≠ficos das modalidades.</p>
                            </div>
                        </div>
                    </a>
                </div>
            </section>
            <section id="modalities" class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Modalidades e Categorias</h2><p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Explore as modalidades dispon√≠veis. Use os filtros para ver as op√ß√µes para cada categoria. Clique em uma modalidade para gerar um plano de treinamento ou ver detalhes de regras/hist√≥rico.</p></div>
                <div class="flex justify-center space-x-2 md:space-x-4 mb-8 flex-wrap gap-2" id="category-filters">
                    <button data-category="all" class="category-btn bg-blue-700 text-white px-5 py-2 rounded-full font-semibold transition">Todas</button>
                    <button data-category="mirim" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Mirim</button>
                    <button data-category="infantil" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Infantil</button>
                    <button data-category="juvenil" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Juvenil</button>
                </div>
                <div id="modalities-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
            </section>
            <section id="timeline" class="py-20">
                <div class="text-center mb-16"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Prazos e Inscri√ß√µes</h2><p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Fique atento √†s datas mais importantes do JEV'S 2025. N√£o perca os prazos!</p></div>
                <div class="relative max-w-4xl mx-auto">
                    <div class="absolute left-1/2 -translate-x-1/2 h-full w-1 bg-blue-200 rounded-full"></div>
                    <div class="relative mb-8"><div class="flex items-center justify-start md:justify-end md:mr-8"><div class="w-full md:w-1/2 md:text-right p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-blue-600">14 de Agosto de 2025</p><h3 class="text-xl font-bold my-1">Congresso T√©cnico</h3><p class="text-slate-600">Apresenta√ß√£o do regulamento e sorteio das chaves.</p></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-blue-700 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">1</div></div>
                    <div class="relative mb-8"><div class="flex items-center justify-start md:ml-8"><div class="w-full md:w-1/2 p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-green-600">29 de Julho a 12 de Agosto de 2025</p><h3 class="text-xl font-bold my-1">Per√≠odo de Inscri√ß√µes</h3><p class="text-slate-600">Inscri√ß√£o das equipes e atletas atrav√©s do site oficial do evento.</p><a href="links.html" target="_blank" class="inline-block mt-3 text-blue-700 font-semibold hover:underline">Acessar Site ‚Üí</a></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-green-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">2</div></div>
                    <div class="relative"><div class="flex items-center justify-start md:justify-end md:mr-8"><div class="w-full md:w-1/2 md:text-right p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-purple-600">01 a 10 de Setembro de 2025</p><h3 class="text-xl font-bold my-1">Realiza√ß√£o dos Jogos</h3><p class="text-slate-600">Abertura no dia 01/09, seguida pelas competi√ß√µes em todas as modalidades.</p></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-purple-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">3</div></div>
                </div>
            </section>
            <section id="scoring" class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Pontua√ß√£o e Premia√ß√£o</h2><p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Entenda como as institui√ß√µes e atletas s√£o pontuados e premiados nos JEV'S 2025.</p></div>
                <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100"><h3 class="text-2xl font-bold text-slate-800 mb-4">Crit√©rios de Pontua√ß√£o da Modalidade (Art. 56)</h3><p class="text-slate-600 mb-4">A pontua√ß√£o das institui√ß√µes para o quadro geral √© diferente para modalidades individuais/lutas e coletivas:</p><div class="mb-6"><h4 class="font-bold text-lg text-blue-700 mb-2">Modalidades Individuais e Lutas:</h4><ul class="list-disc list-inside text-slate-600"><li>Medalha de Ouro: <strong>3 pontos</strong></li><li>Medalha de Prata: <strong>2 pontos</strong></li><li>Medalha de Bronze: <strong>1 ponto</strong></li></ul><p class="text-sm text-slate-500 mt-2">A pontua√ß√£o final da institui√ß√£o √© o somat√≥rio de todas as medalhas conquistadas.</p></div><div><h4 class="font-bold text-lg text-green-600 mb-2">Modalidades Coletivas:</h4><ul class="list-disc list-inside text-slate-600"><li>1¬∫ Lugar: <strong>10 pontos</strong></li><li>2¬∫ Lugar: <strong>7 pontos</strong></li><li>3¬∫ Lugar: <strong>5 pontos</strong></li></ul></div></div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100"><h3 class="text-2xl font-bold text-slate-800 mb-4">Classifica√ß√£o Geral e por Categoria (Art. 55)</h3><p class="text-slate-600 mb-4">A classifica√ß√£o das institui√ß√µes √© feita pelo somat√≥rio dos pontos obtidos em todas as modalidades, g√™neros e categorias.</p><h4 class="font-bold text-lg text-blue-700 mb-2">Crit√©rios de Desempate (Art. 55, ¬ß 3¬∫):</h4><ol class="list-decimal list-inside text-slate-600 space-y-1"><li>Maior n√∫mero de primeiros lugares (Ouro);</li><li>Maior n√∫mero de segundos lugares (Prata);</li><li>Maior n√∫mero de terceiros lugares (Bronze);</li><li>Maior n√∫mero total de atletas participantes na competi√ß√£o;</li><li>Persistindo o empate, a decis√£o ser√° por sorteio.</li></ol><h4 class="font-bold text-lg text-slate-800 mt-6 mb-2">Premia√ß√£o (Art. 57 e 59):</h4><p class="text-slate-600">Trof√©us para as institui√ß√µes campe√£s (geral e por categoria) e medalhas para os alunos-atletas e t√©cnicos (1¬∫, 2¬∫ e 3¬∫ lugares) em cada modalidade, g√™nero e categoria.</p></div>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 mt-8 max-w-4xl mx-auto"><h3 class="text-2xl font-bold text-slate-800 mb-4">Regra de Pontua√ß√£o M√≠nima da Modalidade (Art. 54)</h3><p class="text-slate-600 mb-4">Para que uma modalidade (g√™nero e categoria) possa pontuar para a classifica√ß√£o geral das Institui√ß√µes de Ensino, ela dever√° estar presente em pelo menos <strong>50% do total de Institui√ß√µes de Ensino inscritas</strong> no JEV'S 2025.</p><p class="text-slate-600 mb-4">Caso n√£o atinja esse percentual para a classifica√ß√£o geral, a modalidade poder√° pontuar na <strong>classifica√ß√£o da sua respectiva categoria</strong> (Mirim, Infantil ou Juvenil), desde que atinja o m√≠nimo de <strong>50% do total de Institui√ß√µes de Ensino que tenham equipes ou atletas inscritos naquela categoria espec√≠fica.</strong></p><p class="text-slate-600">Se a modalidade n√£o atingir nenhum dos percentuais m√≠nimos para pontua√ß√£o, as disputas ainda ser√£o realizadas (com m√≠nimo de 3 institui√ß√µes inscritas), mas seus resultados <strong>n√£o ser√£o considerados</strong> para a pontua√ß√£o geral nem por categoria, servindo apenas para participa√ß√£o e desenvolvimento esportivo.</p></div>
            </section>
            <section id="ranking" class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Quadro de Ranking das Escolas</h2><p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Acompanhe a classifica√ß√£o geral e por categoria. O ranking ser√° atualizado durante o evento.</p></div>
                <div class="max-w-5xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <div class="border-b border-slate-200 mb-4">
                        <nav class="-mb-px flex space-x-6" id="ranking-tabs">
                            <button data-target="geral" class="tab-btn active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-700 text-blue-700">Geral</button>
                            <button data-target="juvenil" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300">Juvenil</button>
                            <button data-target="infantil" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300">Infantil</button>
                            <button data-target="mirim" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300">Mirim</button>
                        </nav>
                    </div>
                    <div id="ranking-content">
                        <!-- Ranking tables will be injected here -->
                    </div>
                </div>
            </section>
            <section id="rules" class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Regras Essenciais</h2><p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Um resumo dos pontos mais importantes do regulamento para consulta r√°pida.</p></div>
                <div class="max-w-4xl mx-auto space-y-4" id="accordion"></div>
                <div class="max-w-4xl mx-auto mt-16 bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">‚ú® Explicar Regra em Detalhe com IA</h3>
                    <p class="text-slate-600 mb-4">Selecione uma regra para obter uma explica√ß√£o mais aprofundada, ideal para professores e t√©cnicos.</p>
                    <select id="rule-elaborate-selector" class="w-full p-3 border border-slate-300 rounded-lg mb-4 bg-white text-slate-700 focus:ring-blue-500 focus:border-blue-500"><option value="">Selecione um t√≥pico...</option></select>
                    <button id="elaborate-rule-btn" class="w-full bg-blue-700 text-white px-6 py-3 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">Gerar Explica√ß√£o Detalhada</button>
                    <div id="rule-elaborate-result" class="mt-4 p-4 bg-blue-50/50 rounded-lg hidden"><p id="rule-elaborate-loading" class="text-slate-500 italic"></p><div id="rule-elaborate-content" class="text-slate-700 text-left"></div></div>
                </div>
            </section>
        </main>
    </template>

    <!-- Organizer View Template -->
    <template id="organizer-view-template">
        <main class="container mx-auto px-6">
            <section class="py-20 text-center">
                <h1 class="text-4xl md:text-5xl font-black mb-4"><span class="brand-gradient">Portal do Organizador</span></h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto">Ferramentas e informa√ß√µes para a gest√£o e coordena√ß√£o do JEV'S 2025.</p>
            </section>
            <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 md:col-span-2 lg:col-span-1">
                    <h3 class="font-bold text-xl text-slate-800 mb-3">üìä Estat√≠sticas Gerais</h3>
                    <div class="space-y-3 text-slate-600">
                        <p><strong>Total de Institui√ß√µes:</strong> <span class="font-mono text-blue-700">A ser definido</span></p>
                        <p class="pl-4"><strong>P√∫blicas:</strong> <span class="font-mono text-blue-700">A ser definido</span></p>
                        <p class="pl-4"><strong>Privadas:</strong> <span class="font-mono text-blue-700">A ser definido</span></p>
                        <p><strong>Total de Atletas Inscritos:</strong> <span class="font-mono text-green-700">A ser definido</span></p>
                        <p class="pl-4"><strong>Masculino:</strong> <span class="font-mono text-green-700">A ser definido</span></p>
                        <p class="pl-4"><strong>Feminino:</strong> <span class="font-mono text-green-700">A ser definido</span></p>
                         <p><strong>Total de Equipes (Coletivas):</strong> <span class="font-mono text-indigo-700">A ser definido</span></p>
                        <p><strong>Modalidade com Mais Atletas:</strong> <span class="font-mono text-purple-700">A ser definido</span></p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="font-bold text-xl text-slate-800 mb-3">üîó Links R√°pidos</h3>
                    <div class="space-y-2">
                        <a href="#" class="block text-blue-700 hover:underline">Planilha de Inscri√ß√µes ‚Üí</a>
                        <a href="#" class="block text-blue-700 hover:underline">Contatos de Emerg√™ncia ‚Üí</a>
                        <a href="#" class="block text-blue-700 hover:underline">Regulamento Completo (PDF) ‚Üí</a>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="font-bold text-xl text-slate-800 mb-3">üì£ Comunica√ß√£o</h3>
                    <p class="text-slate-600">Acesso ao painel para envio de comunicados oficiais e boletins.</p>
                    <button class="mt-3 w-full bg-green-600 text-white px-6 py-2 rounded-full hover:bg-green-700 transition">Acessar Painel</button>
                </div>
            </section>
            <section id="timeline" class="py-20">
                <div class="text-center mb-16"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Cronograma Organizacional</h2></div>
                <div class="relative max-w-4xl mx-auto">
                    <div class="absolute left-1/2 -translate-x-1/2 h-full w-1 bg-blue-200 rounded-full"></div>
                    <div class="relative mb-8"><div class="flex items-center justify-start md:justify-end md:mr-8"><div class="w-full md:w-1/2 md:text-right p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-blue-600">14 de Agosto de 2025</p><h3 class="text-xl font-bold my-1">Congresso T√©cnico</h3><p class="text-slate-600">Apresenta√ß√£o do regulamento e sorteio das chaves.</p></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-blue-700 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">1</div></div>
                    <div class="relative mb-8"><div class="flex items-center justify-start md:ml-8"><div class="w-full md:w-1/2 p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-green-600">29 de Julho a 12 de Agosto de 2025</p><h3 class="text-xl font-bold my-1">Per√≠odo de Inscri√ß√µes</h3><p class="text-slate-600">Inscri√ß√£o das equipes e atletas atrav√©s do site oficial do evento.</p><a href="links.html" target="_blank" class="inline-block mt-3 text-blue-700 font-semibold hover:underline">Acessar Site ‚Üí</a></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-green-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">2</div></div>
                    <div class="relative"><div class="flex items-center justify-start md:justify-end md:mr-8"><div class="w-full md:w-1/2 md:text-right p-4"><div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100"><p class="text-sm font-semibold text-purple-600">01 a 10 de Setembro de 2025</p><h3 class="text-xl font-bold my-1">Realiza√ß√£o dos Jogos</h3><p class="text-slate-600">Abertura no dia 01/09, seguida pelas competi√ß√µes em todas as modalidades.</p></div></div></div><div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-purple-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">3</div></div>
                </div>
            </section>
        </main>
    </template>

    <!-- Student View Template -->
    <template id="student-view-template">
        <main class="container mx-auto px-6">
            <section class="py-20 text-center">
                <h1 class="text-4xl md:text-5xl font-black mb-4"><span class="brand-gradient">√Årea do Atleta</span></h1>
                <p class="text-lg text-slate-600 max-w-3xl mx-auto">Tudo o que voc√™ precisa saber para brilhar nos JEV'S 2025!</p>
            </section>
            
            <section class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="font-bold text-2xl text-slate-800 mb-4">‚úÖ Prepare-se para o Grande Dia!</h3>
                    <ul class="space-y-3 text-slate-600">
                        <li class="flex items-center"><span class="text-2xl mr-3">üóìÔ∏è</span> Verificar com meu professor o dia e hora dos meus jogos.</li>
                        <li class="flex items-center"><span class="text-2xl mr-3">üëï</span> Deixar meu uniforme e equipamentos separados.</li>
                        <li class="flex items-center"><span class="text-2xl mr-3">üíß</span> Lembrar de levar minha garrafa de √°gua.</li>
                        <li class="flex items-center"><span class="text-2xl mr-3">ü§ù</span> Competir com garra, mas sempre com respeito.</li>
                        <li class="flex items-center"><span class="text-2xl mr-3">üéâ</span> Me divertir e fazer novas amizades!</li>
                    </ul>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">üìç Locais de Competi√ß√£o</h3>
                    <p class="text-slate-600 mb-4">A cerim√¥nia de abertura ser√° no local principal. Os demais locais ser√£o confirmados em breve. Fique atento aos comunicados do seu professor!</p>
                    <div class="space-y-2">
                        <p><strong>Principal:</strong> Gin√°sio Poliesportivo "O Senadinho"</p>
                        <p><strong>Outros:</strong> A confirmar</p>
                    </div>
                     <div class="mt-4 h-40 bg-slate-200 rounded-lg flex items-center justify-center text-slate-500">
                        <p>Mapa interativo em breve</p>
                    </div>
                </div>
            </section>

            <section class="py-20">
                 <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">D√∫vidas Frequentes</h2></div>
                 <div class="max-w-4xl mx-auto space-y-4" id="student-faq-accordion"></div>
            </section>

            <section class="py-10">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Valores dos Jogos</h2></div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto" id="values-cards">
                    <div class="value-card bg-white p-6 rounded-2xl shadow-md text-center cursor-pointer transform hover:-translate-y-1 transition duration-300" data-title="Respeito" data-description="Respeitar as regras, os advers√°rios, os √°rbitros e os colegas de equipe √© a base de qualquer esporte. A vit√≥ria s√≥ tem valor quando conquistada de forma justa e honesta."><div class="text-5xl mb-3">ü§ù</div><h4 class="font-bold text-lg text-slate-800">Respeito</h4></div>
                    <div class="value-card bg-white p-6 rounded-2xl shadow-md text-center cursor-pointer transform hover:-translate-y-1 transition duration-300" data-title="Amizade" data-description="Os jogos s√£o uma oportunidade incr√≠vel para conhecer novas pessoas e fortalecer la√ßos. As amizades que voc√™ faz no esporte podem durar a vida toda."><div class="text-5xl mb-3">üòä</div><h4 class="font-bold text-lg text-slate-800">Amizade</h4></div>
                    <div class="value-card bg-white p-6 rounded-2xl shadow-md text-center cursor-pointer transform hover:-translate-y-1 transition duration-300" data-title="Supera√ß√£o" data-description="Competir √© sobre dar o seu melhor, desafiar seus limites e aprender com cada vit√≥ria e derrota. O maior pr√™mio √© a sua evolu√ß√£o pessoal."><div class="text-5xl mb-3">üèÜ</div><h4 class="font-bold text-lg text-slate-800">Supera√ß√£o</h4></div>
                    <div class="value-card bg-white p-6 rounded-2xl shadow-md text-center cursor-pointer transform hover:-translate-y-1 transition duration-300" data-title="Divers√£o" data-description="Lembre-se que o esporte √©, acima de tudo, uma fonte de alegria. Aproveite cada momento, celebre cada ponto e divirta-se com sua equipe!"><div class="text-5xl mb-3">üéâ</div><h4 class="font-bold text-lg text-slate-800">Divers√£o</h4></div>
                </div>
            </section>

            <section class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Princ√≠pios do Esporte Educacional</h2></div>
                <div class="principle-wheel" id="principles-wheel">
                    <div class="principle-slice" data-title="Inclus√£o" data-content="Nos JEV's, todos t√™m o direito de participar, n√£o importa o n√≠vel de habilidade, g√™nero ou origem. O esporte educacional √© um espa√ßo que acolhe a todos e celebra a diversidade de cada atleta, garantindo que ningu√©m fique de fora da festa."><h4 class="font-bold text-lg text-slate-800">Inclus√£o</h4></div>
                    <div class="principle-slice" data-title="Participa√ß√£o" data-content="Mais importante do que a vit√≥ria √© a jornada. O esporte na escola √© uma ferramenta para que todos possam vivenciar a alegria do jogo, aprender com os desafios e se desenvolver como pessoas e cidad√£os. Cada momento em quadra √© uma vit√≥ria."><h4 class="font-bold text-lg text-slate-800">Participa√ß√£o</h4></div>
                    <div class="principle-slice" data-title="Coopera√ß√£o" data-content="Aprender a jogar junto, a confiar no colega e a trabalhar em equipe √© uma das li√ß√µes mais valiosas do esporte. A coopera√ß√£o, a ajuda m√∫tua e o esfor√ßo coletivo s√£o essenciais para alcan√ßar objetivos comuns e formam a base de uma comunidade mais unida."><h4 class="font-bold text-lg text-slate-800">Coopera√ß√£o</h4></div>
                    <div class="principle-slice" data-title="Autonomia" data-content="O esporte ensina a tomar decis√µes r√°pidas, a ter responsabilidade por suas a√ß√µes e a liderar pelo exemplo. Participar dos jogos ajuda voc√™ a se tornar mais independente, confiante e preparado para os desafios dentro e fora de quadra."><h4 class="font-bold text-lg text-slate-800">Autonomia</h4></div>
                </div>
            </section>

            <section class="py-20">
                <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-slate-800">Resultados dos Jogos</h2></div>
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center">
                    <p class="text-slate-600 mb-4">Os resultados das partidas e competi√ß√µes ser√£o atualizados aqui durante o evento. Fique de olho e tor√ßa pela sua escola!</p>
                    <a href="#" class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-full hover:bg-indigo-700 transition">Ver Quadro de Medalhas (em breve)</a>
                </div>
            </section>

            <section class="py-20">
                <div class="mt-16 max-w-4xl mx-auto">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 mb-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-4">‚ú® Dicas de Treino e Alimenta√ß√£o</h3>
                        <p class="text-slate-600 mb-4">Obtenha sugest√µes de treino e alimenta√ß√£o para melhorar capacidades espec√≠ficas no seu esporte.</p>
                        <input type="text" id="sport-input-student" placeholder="Ex: Futsal, Atletismo, Nata√ß√£o..." class="w-full p-3 border border-slate-300 rounded-lg mb-4 bg-white text-slate-700 focus:ring-blue-500 focus:border-blue-500">
                        <button id="generate-training-nutrition-tips-btn-student" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-full hover:bg-indigo-700 transition flex items-center justify-center">Gerar Dicas Personalizadas</button>
                        <div id="training-nutrition-tips-result-student" class="mt-4 p-4 bg-indigo-50/50 rounded-lg hidden"><p id="training-nutrition-tips-loading-student" class="text-slate-500 italic"></p><div id="training-nutrition-tips-content-student" class="text-slate-700 text-left"></div></div>
                    </div>
                </div>
            </section>
        </main>
    </template>

    <!-- Generic Info Modal -->
    <div id="info-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
             <button id="close-info-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 id="info-modal-title" class="text-2xl font-bold text-slate-800 mb-4 text-center"></h3>
            <p id="info-modal-content" class="text-slate-600 text-center"></p>
        </div>
    </div>

    <!-- Modality AI Modal -->
    <div id="modality-ai-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 id="modal-modality-name" class="text-2xl font-bold text-slate-800 mb-6 text-center"></h3>
            <div id="modality-static-details" class="mb-6 text-center text-slate-600"></div>
            <div id="modality-description-area" class="mb-6">
                <p id="modality-description-loading" class="text-slate-500 italic text-center"></p>
                <div id="modality-description-content" class="text-slate-700 text-left"></div>
            </div>
            <div class="flex justify-center space-x-4 mb-6 flex-wrap gap-2">
                <button id="generate-training-plan-btn" class="bg-blue-700 text-white px-5 py-2 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">Elaborar Plano de Treinamento</button>
                <button id="view-rules-history-btn" class="bg-green-600 text-white px-5 py-2 rounded-full hover:bg-green-700 transition shadow-lg shadow-green-600/20 flex items-center justify-center">Ver Regras e Hist√≥rico</button>
            </div>
            <div id="modality-ai-result" class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                <p id="modality-ai-loading" class="text-slate-500 italic text-center"></p>
                <div id="modality-ai-content" class="text-slate-700 text-left"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-300 mt-20">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2025 Prefeitura Municipal de Teot√¥nio Vilela - Secretaria de Educa√ß√£o.</p>
            <p class="text-sm text-slate-400 mt-2">Desenvolvido para facilitar o acesso √† informa√ß√£o dos JEV'S 2025.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const profileSelector = document.getElementById('profile-selector');
            const contentWrapper = document.getElementById('content-wrapper');
            const mainContentContainer = document.getElementById('main-content');
            const profileButtons = document.querySelectorAll('.profile-btn');
            const switchProfileBtn = document.getElementById('switch-profile-btn');
            const organizerLoginModal = document.getElementById('organizer-login-modal');
            const closeLoginModalBtn = document.getElementById('close-login-modal-btn');
            const organizerLoginForm = document.getElementById('organizer-login-form');

            const teacherTemplate = document.getElementById('teacher-view-template');
            const organizerTemplate = document.getElementById('organizer-view-template');
            const studentTemplate = document.getElementById('student-view-template');

            const mainNav = document.getElementById('main-nav');
            const ctaButton = document.getElementById('cta-button');
            const mobileMenuButton = document.getElementById('mobile-menu-button');

            const updateHeaderVisibility = (profile) => {
                const isTeacher = profile === 'teacher';
                mainNav.style.display = isTeacher ? 'flex' : 'none';
                ctaButton.style.display = isTeacher ? 'block' : 'none';
                mobileMenuButton.style.display = isTeacher ? 'block' : 'none';
            };

            const showProfileView = (profile) => {
                mainContentContainer.innerHTML = ''; // Clear previous content
                let template;
                if (profile === 'teacher') {
                    template = teacherTemplate.content.cloneNode(true);
                } else if (profile === 'organizer') {
                    template = organizerTemplate.content.cloneNode(true);
                } else if (profile === 'student') {
                    template = studentTemplate.content.cloneNode(true);
                }
                
                if (template) {
                    mainContentContainer.appendChild(template);
                    profileSelector.classList.add('hidden');
                    contentWrapper.classList.remove('hidden');
                    organizerLoginModal.classList.remove('open');
                    updateHeaderVisibility(profile);
                    initializePageFunctions();
                }
            };

            profileButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const profile = button.dataset.profile;
                    if (profile === 'organizer') {
                        organizerLoginModal.classList.add('open');
                    } else {
                        showProfileView(profile);
                    }
                });
            });

            if (switchProfileBtn) {
                switchProfileBtn.addEventListener('click', () => {
                    contentWrapper.classList.add('hidden');
                    profileSelector.classList.remove('hidden');
                    mainContentContainer.innerHTML = '';
                    updateHeaderVisibility('teacher'); // Reset header to default
                });
            }

            if (closeLoginModalBtn) {
                closeLoginModalBtn.addEventListener('click', () => {
                    organizerLoginModal.classList.remove('open');
                });
            }
            
            if (organizerLoginModal) {
                 organizerLoginModal.addEventListener('click', (e) => {
                    if (e.target === organizerLoginModal) {
                        organizerLoginModal.classList.remove('open');
                    }
                });
            }

            if (organizerLoginForm) {
                organizerLoginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = e.target.username.value;
                    const password = e.target.password.value;
                    const errorEl = document.getElementById('login-error');
                    const btnText = document.getElementById('login-btn-text');
                    const loader = document.getElementById('login-loader');
                    
                    errorEl.textContent = '';
                    btnText.classList.add('hidden');
                    loader.classList.remove('hidden');

                    const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/14MwUY_CZ1yHvXbmSIv-QumVspmRrU8BEqGs6mlYCZpc/export?format=csv';

                    if (googleSheetUrl === 'COLE_O_SEU_LINK_CSV_PUBLICADO_AQUI') {
                        errorEl.textContent = 'Erro de configura√ß√£o: URL da planilha n√£o definida.';
                        btnText.classList.remove('hidden');
                        loader.classList.add('hidden');
                        return;
                    }

                    try {
                        const response = await fetch(googleSheetUrl);
                        if (!response.ok) throw new Error('N√£o foi poss√≠vel buscar os dados de login.');
                        
                        const data = await response.text();
                        const users = data.trim().split(/\r?\n/).slice(1).map(row => {
                            const [user, pass] = row.split(',');
                            return { username: user.trim(), password: pass.trim() };
                        });

                        const foundUser = users.find(user => user.username === username && user.password === password);

                        if (foundUser) {
                            showProfileView('organizer');
                        } else {
                            errorEl.textContent = 'Usu√°rio ou senha inv√°lidos.';
                        }
                    } catch (error) {
                        console.error('Erro no login:', error);
                        errorEl.textContent = 'Ocorreu um erro. Tente novamente.';
                    } finally {
                        btnText.classList.remove('hidden');
                        loader.classList.add('hidden');
                    }
                });
            }

            function initializePageFunctions() {
                 // --- DATA ---
                const modalities = [
                    { name: 'Atletismo', icon: 'üèÉ', type: 'Individual', athletes: '15-21 por g√™nero', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Basquete', icon: 'üèÄ', type: 'Coletivo', athletes: 'At√© 10', categories: ['infantil', 'juvenil'] },
                    { name: 'Basquete 3x3', icon: 'üèÄ', type: 'Coletivo', athletes: 'At√© 4', categories: ['infantil', 'juvenil'] },
                    { name: 'Capoeira', icon: 'ü§∏', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Cubo M√°gico', icon: 'https://cinoto.com.br/cubomagico/wp-content/uploads/2020/02/fellow.jpg', isImage: true, type: 'Individual', athletes: 'At√© 4', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Futsal', icon: '‚öΩ', type: 'Coletivo', athletes: 'At√© 10', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Futev√¥lei', icon: 'üèê', type: 'Individual/Dupla', athletes: '2 duplas', categories: ['infantil', 'juvenil'] },
                    { name: 'V√¥lei de praia', icon: 'üèñÔ∏è', type: 'Dupla', athletes: '2 duplas', categories: ['infantil', 'juvenil'] },
                    { name: 'Handebol', icon: 'ü§æ', type: 'Coletivo', athletes: 'At√© 12', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Jiu-Jitsu', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Karat√™', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Queimado', icon: 'üéØ', type: 'Coletivo', athletes: 'At√© 12', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Xadrez', icon: '‚ôüÔ∏è', type: 'Individual', athletes: 'At√© 4', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Jud√¥', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Taekwondo', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                    { name: 'Wrestling', icon: 'ü§º', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['infantil', 'juvenil'] },
                ];

                const rules = [
                    { title: "Composi√ß√£o das Equipes (Art. 17)", content: "Cada equipe pode ter at√© 14 participantes, sendo 12 atletas e 2 t√©cnicos/auxiliares. A equipe de gest√£o (diretor/coordenador) pode ter at√© 2 membros inscritos, que podem ficar no banco de reservas e se responsabilizar pela equipe na aus√™ncia do t√©cnico." },
                    { title: "Condi√ß√£o de Participa√ß√£o (Art. 21-27)", content: "Podem participar alunos de 9 a 17 anos, regularmente matriculados. Cada atleta pode competir em at√© 3 modalidades (2 individuais e 1 coletiva). √â obrigat√≥ria a presen√ßa de um respons√°vel (t√©cnico, auxiliar ou gestor) inscrito na s√∫mula durante os jogos." },
                    { title: "Sistema de Competi√ß√£o (Art. 37-45)", content: "As competi√ß√µes s√≥ ocorrem com no m√≠nimo 3 institui√ß√µes inscritas. O sistema de disputa (rod√≠zio, cruzamento, etc.) varia conforme o n√∫mero de equipes. Os detalhes e chaveamentos s√£o definidos no Congresso T√©cnico. Equipes podem jogar mais de uma vez por dia, com intervalo m√≠nimo de 2 horas." },
                    { title: "Regra de W.O. (Art. 47)", content: "A toler√¢ncia de atraso √© de 15 minutos para a primeira partida do dia. Para as demais, a toler√¢ncia √© de 5 minutos. O W.O. n√£o elimina a equipe em fases de rod√≠zio, mas o caso √© encaminhado √† Comiss√£o Disciplinar. O placar do W.O. varia por modalidade (ex: Futsal 1x0, Basquete 20x0)." },
                    { title: "Uniformes (Art. 60-63)", content: "As equipes devem se apresentar devidamente uniformizadas. Em caso de uniformes com cores coincidentes, um sorteio definir√° qual equipe usar√° os coletes fornecidos pela organiza√ß√£o. A comiss√£o t√©cnica tamb√©m deve estar vestida adequadamente (camisa, cal√ßa/bermuda e cal√ßado fechado)." },
                    { title: "Protestos (Art. 65-68)", content: "Protestos devem ser formalizados em formul√°rio pr√≥prio e entregues at√© as 20:00h do dia do fato via link oficial, ou presencialmente at√© as 18:00h. O reclamante deve apresentar provas materiais. Protestos infundados ser√£o analisados pela Comiss√£o Disciplinar." },
                    { title: "Pontua√ß√£o M√≠nima da Modalidade (Art. 54)", content: "Para pontuar na classifica√ß√£o geral, a modalidade (g√™nero e categoria) deve ter pelo menos 50% das institui√ß√µes inscritas no JEV'S. Se n√£o atingir, pode pontuar na categoria espec√≠fica se tiver 50% das institui√ß√µes inscritas naquela categoria. Se n√£o atingir nenhum, a disputa √© s√≥ para participa√ß√£o (m√≠nimo 3 institui√ß√µes), sem pontua√ß√£o." }
                ];

                const studentFaqs = [
                    { title: "O que eu preciso levar no dia do jogo?", content: "√â essencial levar seu documento de identifica√ß√£o, uniforme completo, equipamentos espec√≠ficos da sua modalidade (se houver), garrafa de √°gua e um lanche leve. Converse com seu professor para confirmar se h√° mais alguma necessidade." },
                    { title: "Posso participar de quantas modalidades?", content: "De acordo com o Art. 22 do regulamento, cada atleta pode se inscrever em at√© 3 modalidades, sendo no m√°ximo 2 individuais (como atletismo, xadrez, lutas) e 1 coletiva (futsal, handebol, etc.)." },
                    { title: "O que acontece se eu me atrasar para um jogo?", content: "Existe uma toler√¢ncia de 15 minutos de atraso para o primeiro jogo do dia e 5 minutos para os demais. Se sua equipe n√£o estiver pronta ap√≥s esse tempo, ser√° considerado W.O. (derrota por aus√™ncia). Por isso, chegue sempre com anteced√™ncia!" },
                    { title: "Onde vejo a tabela com os hor√°rios dos meus jogos?", content: "A tabela oficial com datas, hor√°rios e locais ser√° divulgada no site do evento e enviada para os professores/t√©cnicos respons√°veis. A melhor forma de saber √© sempre confirmar com seu professor." },
                    { title: "Preciso de autoriza√ß√£o dos meus pais?", content: "Sim, a participa√ß√£o de menores de idade geralmente requer um termo de responsabilidade e cess√£o de direitos assinado pelos pais ou respons√°veis. Verifique com seu professor se toda a documenta√ß√£o da sua escola est√° em dia." },
                    { title: "Como funciona a premia√ß√£o?", content: "Ser√£o premiados com medalhas os atletas e t√©cnicos das equipes que ficarem em 1¬∫, 2¬∫ e 3¬∫ lugar em cada modalidade, categoria e g√™nero. As escolas campe√£s gerais e por categoria tamb√©m receber√£o trof√©us." },
                    { title: "O que fazer se eu me machucar durante um jogo?", content: "Comunique imediatamente seu t√©cnico e o √°rbitro. O evento contar√° com suporte de primeiros socorros nos locais de competi√ß√£o para garantir o atendimento r√°pido e adequado a todos os atletas." }
                ];
                
                const principles = [
                    { title: "Princ√≠pio da Inclus√£o", content: "Nos JEV's, todos t√™m o direito de participar, n√£o importa o n√≠vel de habilidade, g√™nero ou origem. O esporte educacional √© um espa√ßo que acolhe a todos e celebra a diversidade de cada atleta, garantindo que ningu√©m fique de fora da festa." },
                    { title: "Princ√≠pio da Participa√ß√£o", content: "Mais importante do que a vit√≥ria √© a jornada. O esporte na escola √© uma ferramenta para que todos possam vivenciar a alegria do jogo, aprender com os desafios e se desenvolver como pessoas e cidad√£os. Cada momento em quadra √© uma vit√≥ria." },
                    { title: "Princ√≠pio da Coopera√ß√£o", content: "Aprender a jogar junto, a confiar no colega e a trabalhar em equipe √© uma das li√ß√µes mais valiosas do esporte. A coopera√ß√£o, a ajuda m√∫tua e o esfor√ßo coletivo s√£o essenciais para alcan√ßar objetivos comuns e formam a base de uma comunidade mais unida." },
                    { title: "Princ√≠pio da Autonomia", content: "O esporte ensina a tomar decis√µes r√°pidas, a ter responsabilidade por suas a√ß√µes e a liderar pelo exemplo. Participar dos jogos ajuda voc√™ a se tornar mais independente, confiante e preparado para os desafios dentro e fora de quadra." }
                ];

                // --- MOBILE MENU ---
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenuButton) {
                    mobileMenuButton.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                    });
                }
                
                // --- COUNTDOWN ---
                const countdownElement = document.getElementById('countdown');
                if(countdownElement) {
                    const eventDate = new Date('2025-09-01T10:00:00').getTime();
                    const updateCountdown = () => {
                        const now = new Date().getTime();
                        const distance = eventDate - now;
                        if (distance < 0) {
                            countdownElement.innerHTML = `<div class="text-2xl font-bold text-green-600 bg-white/80 p-6 rounded-2xl shadow-lg">O JEV'S 2025 j√° come√ßou!</div>`;
                            return;
                        }
                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                        document.getElementById('days').innerText = String(days).padStart(2, '0');
                        document.getElementById('hours').innerText = String(hours).padStart(2, '0');
                        document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
                        document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
                    };
                    setInterval(updateCountdown, 1000);
                    updateCountdown();
                }

                // --- MODALITIES FILTERING ---
                const modalitiesGrid = document.getElementById('modalities-grid');
                const categoryFilters = document.getElementById('category-filters');
                const categoryButtons = categoryFilters ? categoryFilters.querySelectorAll('.category-btn') : [];

                const renderModalities = (category = 'all') => {
                    if (!modalitiesGrid) return;
                    modalitiesGrid.innerHTML = '';
                    const filteredModalities = category === 'all'
                        ? modalities
                        : modalities.filter(m => m.categories.includes(category));
                    
                    filteredModalities.forEach(mod => {
                        const card = document.createElement('div');
                        card.className = `modality-card bg-white p-6 rounded-2xl shadow-md border border-slate-100 transform hover:-translate-y-1 transition duration-300 flex flex-col items-center text-center cursor-pointer`;
                        card.dataset.categories = mod.categories.join(' ');
                        card.dataset.modalityName = mod.name;
                        card.dataset.modalityIcon = mod.icon;
                        card.dataset.isImage = !!mod.isImage;
                        card.dataset.modalityType = mod.type;
                        card.dataset.modalityAthletes = mod.athletes;
                        
                        const iconHTML = mod.isImage 
                            ? `<div class="card-icon"><img src="${mod.icon}" alt="${mod.name}" class="max-h-full w-auto"></div>`
                            : `<div class="card-icon text-5xl">${mod.icon}</div>`;

                        card.innerHTML = `
                            ${iconHTML}
                            <h4 class="font-bold text-lg text-slate-800 flex-grow">${mod.name}</h4>
                            <div class="flex space-x-2 mt-4">
                                ${mod.categories.includes('mirim') ? '<span class="bg-yellow-200 text-yellow-800 text-xs font-semibold px-2 py-1 rounded-full">Mirim</span>' : ''}
                                ${mod.categories.includes('infantil') ? '<span class="bg-green-200 text-green-800 text-xs font-semibold px-2 py-1 rounded-full">Infantil</span>' : ''}
                                ${mod.categories.includes('juvenil') ? '<span class="bg-blue-200 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full">Juvenil</span>' : ''}
                            </div>`;
                        modalitiesGrid.appendChild(card);
                    });
                };

                if (categoryFilters) {
                    categoryFilters.addEventListener('click', (e) => {
                        if (e.target.classList.contains('category-btn')) {
                            const selectedCategory = e.target.dataset.category;
                            categoryButtons.forEach(btn => {
                                btn.classList.remove('bg-blue-700', 'text-white');
                                btn.classList.add('bg-white', 'text-slate-700');
                            });
                            e.target.classList.add('bg-blue-700', 'text-white');
                            e.target.classList.remove('bg-white', 'text-slate-700');
                            renderModalities(selectedCategory);
                        }
                    });
                }

                // --- ACCORDION ---
                function createAccordion(containerId, items) {
                    const accordion = document.getElementById(containerId);
                    if (accordion) {
                        accordion.innerHTML = ''; // Clear existing items
                        items.forEach((item) => {
                            const accordionItem = document.createElement('div');
                            accordionItem.className = 'bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden';
                            accordionItem.innerHTML = `
                                <button class="accordion-toggle w-full flex justify-between items-center p-6 text-left font-semibold text-slate-800 hover:bg-slate-50 transition">
                                    <span>${item.title}</span>
                                    <svg class="accordion-icon w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div class="accordion-content max-h-0 overflow-hidden transition-all duration-500 ease-in-out"><div class="p-6 pt-0 text-slate-600"><p>${item.content}</p></div></div>`;
                            accordion.appendChild(accordionItem);
                        });
                        
                        accordion.addEventListener('click', (e) => {
                            const toggle = e.target.closest('.accordion-toggle');
                            if (toggle) {
                                const content = toggle.nextElementSibling;
                                const icon = toggle.querySelector('.accordion-icon');
                                document.querySelectorAll(`#${containerId} .accordion-content`).forEach(el => {
                                    if (el !== content) {
                                        el.style.maxHeight = null;
                                        const otherIcon = el.previousElementSibling?.querySelector('.accordion-icon');
                                        if (otherIcon) otherIcon.classList.remove('rotate-180');
                                    }
                                });
                                if (content.style.maxHeight) {
                                    content.style.maxHeight = null;
                                    icon.classList.remove('rotate-180');
                                } else {
                                    content.style.maxHeight = content.scrollHeight + "px";
                                    icon.classList.add('rotate-180');
                                }
                            }
                        });
                    }
                }
                
                createAccordion('accordion', rules);
                createAccordion('student-faq-accordion', studentFaqs);
                
                // --- MODALITIES CHART ---
                const ctx = document.getElementById('modalitiesChart');
                if (ctx) {
                    const mirimCount = modalities.filter(m => m.categories.includes('mirim')).length;
                    const infantilCount = modalities.filter(m => m.categories.includes('infantil')).length;
                    const juvenilCount = modalities.filter(m => m.categories.includes('juvenil')).length;
                    new Chart(ctx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Mirim (9-11 anos)', 'Infantil (12-14 anos)', 'Juvenil (15-17 anos)'],
                            datasets: [{
                                label: 'N¬∫ de Modalidades',
                                data: [mirimCount, infantilCount, juvenilCount],
                                backgroundColor: ['rgba(253, 224, 71, 0.6)', 'rgba(74, 222, 128, 0.6)', 'rgba(96, 165, 250, 0.6)'],
                                borderColor: ['rgba(253, 224, 71, 1)', 'rgba(74, 222, 128, 1)', 'rgba(96, 165, 250, 1)'],
                                borderWidth: 1,
                                borderRadius: 8,
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false,
                            plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', titleFont: { size: 14, weight: 'bold' }, bodyFont: { size: 12 }, padding: 12, cornerRadius: 8, displayColors: false, } },
                            scales: { y: { beginAtZero: true, grid: { color: '#e2e8f0' }, ticks: { color: '#475569' } }, x: { grid: { display: false }, ticks: { color: '#475569' } } }
                        }
                    });
                }
                
                // --- RANKING TABS ---
                const rankingTabs = document.getElementById('ranking-tabs');
                const rankingContent = document.getElementById('ranking-content');
                
                const rankingUrls = {
                    geral: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSnxqp5IlXumIec_AavCXNr3IEh-CcjpbE-xof3BooXZGNafHwqYXHlZYRbXf128rCsEef4nWApKwK4/pub?gid=0&single=true&output=csv',
                    juvenil: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSnxqp5IlXumIec_AavCXNr3IEh-CcjpbE-xof3BooXZGNafHwqYXHlZYRbXf128rCsEef4nWApKwK4/pub?gid=623963326&single=true&output=csv',
                    infantil: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSnxqp5IlXumIec_AavCXNr3IEh-CcjpbE-xof3BooXZGNafHwqYXHlZYRbXf128rCsEef4nWApKwK4/pub?gid=1173262793&single=true&output=csv',
                    mirim: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSnxqp5IlXumIec_AavCXNr3IEh-CcjpbE-xof3BooXZGNafHwqYXHlZYRbXf128rCsEef4nWApKwK4/pub?gid=308596143&single=true&output=csv'
                };

                const renderRankingTable = async (category) => {
                    if (!rankingContent) return;
                    rankingContent.innerHTML = `<p class="text-slate-500 text-center">Carregando ranking...</p>`;
                    try {
                        const url = rankingUrls[category];
                        const response = await fetch(url);
                        if (!response.ok) throw new Error('Falha ao carregar os dados.');
                        
                        const csvText = await response.text();
                        const rows = csvText.trim().split(/\r?\n/).slice(1);
                        const data = rows.map(row => {
                            const [pos, school, score] = row.split(',');
                            return { pos, school, score };
                        });

                        let tableHTML = `
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-slate-200">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Posi√ß√£o</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Escola</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Pontua√ß√£o</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-slate-200">`;
                        
                        data.forEach(item => {
                            tableHTML += `
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${item.pos}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${item.school}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 font-bold">${item.score}</td>
                                </tr>`;
                        });

                        tableHTML += `</tbody></table></div>`;
                        rankingContent.innerHTML = tableHTML;
                    } catch (error) {
                        console.error('Erro ao carregar ranking:', error);
                        rankingContent.innerHTML = `<p class="text-red-500 text-center">N√£o foi poss√≠vel carregar o ranking. Tente novamente mais tarde.</p>`;
                    }
                };

                if (rankingTabs) {
                    rankingTabs.addEventListener('click', (e) => {
                        if (e.target.classList.contains('tab-btn')) {
                            document.querySelectorAll('#ranking-tabs .tab-btn').forEach(btn => {
                                btn.classList.remove('active', 'border-blue-700', 'text-blue-700');
                                btn.classList.add('border-transparent', 'text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300');
                            });
                            e.target.classList.add('active', 'border-blue-700', 'text-blue-700');
                            e.target.classList.remove('border-transparent', 'text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300');
                            renderRankingTable(e.target.dataset.target);
                        }
                    });
                    renderRankingTable('geral');
                }


                // --- LLM INTEGRATIONS ---
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                async function callGeminiAPI(prompt, loadingElement, contentElement, errorPrefix) {
                    if (loadingElement) loadingElement.textContent = 'Gerando... Por favor, aguarde.';
                    if (contentElement) contentElement.innerHTML = '';
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    try {
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        const result = await response.json();
                        if (response.ok && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (contentElement) contentElement.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>');
                            if (loadingElement) loadingElement.textContent = '';
                        } else { throw new Error(result.error?.message || 'Resposta inesperada da API.'); }
                    } catch (error) {
                        console.error(`Erro ao chamar a API Gemini para ${errorPrefix}:`, error);
                        if (loadingElement) loadingElement.textContent = `Erro ao gerar conte√∫do. Verifique a conex√£o ou tente mais tarde.`;
                    }
                }

                function setupAITool(buttonId, inputId, resultContainerId, loadingId, contentId, promptGenerator) {
                    const button = document.getElementById(buttonId);
                    const input = document.getElementById(inputId);
                    if (button) {
                        button.addEventListener('click', () => {
                            const inputValue = input ? input.value.trim() : 'general';
                            if (input && input.tagName === 'SELECT' && !inputValue) {
                                const content = document.getElementById(contentId);
                                if (content) content.innerHTML = '<p class="text-red-500">Por favor, selecione uma op√ß√£o.</p>';
                                document.getElementById(resultContainerId)?.classList.remove('hidden');
                                return;
                            }
                            if (input && input.tagName === 'INPUT' && !inputValue) {
                                const content = document.getElementById(contentId);
                                if (content) content.innerHTML = '<p class="text-red-500">Por favor, preencha o campo necess√°rio.</p>';
                                document.getElementById(resultContainerId)?.classList.remove('hidden');
                                return;
                            }
                            const resultContainer = document.getElementById(resultContainerId);
                            const loading = document.getElementById(loadingId);
                            const content = document.getElementById(contentId);
                            if (resultContainer) resultContainer.classList.remove('hidden');
                            const prompt = promptGenerator(inputValue);
                            callGeminiAPI(prompt, loading, content, 'AI Tool');
                        });
                    }
                }

                setupAITool('generate-training-nutrition-tips-btn', 'sport-input', 'training-nutrition-tips-result', 'training-nutrition-tips-loading', 'training-nutrition-tips-content', (sportName) => `Gere dicas de treino e alimenta√ß√£o para atletas escolares de ${sportName}. Inclua sugest√µes para treino (for√ßa, velocidade, etc.) e alimenta√ß√£o (pr√©/p√≥s-treino). Formate com t√≥picos e negrito.`);
                setupAITool('generate-training-nutrition-tips-btn-student', 'sport-input-student', 'training-nutrition-tips-result-student', 'training-nutrition-tips-loading-student', 'training-nutrition-tips-content-student', (sportName) => `Gere dicas de treino e alimenta√ß√£o para atletas escolares de ${sportName}. Inclua sugest√µes para treino (for√ßa, velocidade, etc.) e alimenta√ß√£o (pr√©/p√≥s-treino). Formate com t√≥picos e negrito.`);
                
                function populateRuleSelectors() {
                    const elaborateSelector = document.getElementById('rule-elaborate-selector');
                    const summarySelector = document.getElementById('rule-summary-selector');
                    if (elaborateSelector) {
                        elaborateSelector.innerHTML = '<option value="">Selecione um t√≥pico...</option>';
                        rules.forEach((rule, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = rule.title;
                            elaborateSelector.appendChild(option);
                        });
                    }
                    if (summarySelector) {
                        summarySelector.innerHTML = '<option value="">Selecione um t√≥pico...</option>';
                        rules.forEach((rule, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = rule.title;
                            summarySelector.appendChild(option);
                        });
                    }
                }
                populateRuleSelectors();

                setupAITool('elaborate-rule-btn', 'rule-elaborate-selector', 'rule-elaborate-result', 'rule-elaborate-loading', 'rule-elaborate-content', (selectedIndex) => {
                    const rule = rules[selectedIndex];
                    return `Explique em detalhes a regra sobre '${rule.title}' do regulamento dos JEV'S, considerando o contexto de um professor/t√©cnico. A regra √©: '${rule.content}'. D√™ exemplos pr√°ticos. Formate de forma did√°tica com negrito.`;
                });
                setupAITool('summarize-rule-btn', 'rule-summary-selector', 'rule-summary-result', 'rule-summary-loading', 'rule-summary-content', (selectedIndex) => {
                    const rule = rules[selectedIndex];
                    return `Resuma a regra '${rule.title}' dos JEV'S de forma concisa para um atleta. A regra √©: '${rule.content}'.`;
                });

                // --- Modality AI Modal Logic ---
                const modalityAiModal = document.getElementById('modality-ai-modal');
                const closeModalBtn = document.getElementById('close-modal-btn');
                const modalModalityName = document.getElementById('modal-modality-name');
                const generateTrainingPlanBtn = document.getElementById('generate-training-plan-btn');
                const viewRulesHistoryBtn = document.getElementById('view-rules-history-btn');
                const modalityAiResult = document.getElementById('modality-ai-result');
                const modalityAiLoading = document.getElementById('modality-ai-loading');
                const modalityAiContent = document.getElementById('modality-ai-content');
                const modalityStaticDetails = document.getElementById('modality-static-details');
                const modalityDescriptionLoading = document.getElementById('modality-description-loading');
                const modalityDescriptionContent = document.getElementById('modality-description-content');
                let currentModalityName = '';

                const modalitiesGridForModal = document.getElementById('modalities-grid');
                if (modalitiesGridForModal) {
                    modalitiesGridForModal.addEventListener('click', async (e) => {
                        const card = e.target.closest('.modality-card');
                        if (!card) return;
                        currentModalityName = card.dataset.modalityName;
                        if (modalModalityName) modalModalityName.textContent = currentModalityName;
                        if (modalityStaticDetails) {
                            const modalityIcon = card.dataset.modalityIcon;
                            const isImageIcon = card.dataset.isImage === 'true';
                            const modalityType = card.dataset.modalityType;
                            const modalityAthletes = card.dataset.modalityAthletes;
                            const modalityCategories = card.dataset.categories.split(' ').map(cat => `<span class="${cat === 'mirim' ? 'bg-yellow-200 text-yellow-800' : cat === 'infantil' ? 'bg-green-200 text-green-800' : 'bg-blue-200 text-blue-800'} text-xs font-semibold px-2 py-1 rounded-full">${cat.charAt(0).toUpperCase() + cat.slice(1)}</span>`).join(' ');
                            
                            const iconHTML = isImageIcon 
                                ? `<div class="card-icon"><img src="${modalityIcon}" alt="${currentModalityName}" class="max-h-full w-auto"></div>`
                                : `<div class="card-icon text-6xl">${modalityIcon}</div>`;

                            modalityStaticDetails.innerHTML = `${iconHTML}<p class="text-lg font-semibold mb-2">Tipo: ${modalityType}</p><p class="text-lg font-semibold mb-2">Atletas: ${modalityAthletes || 'N√£o especificado'}</p><div class="flex justify-center space-x-2">${modalityCategories}</div>`;
                        }
                        if (modalityAiResult) modalityAiResult.classList.add('hidden');
                        if (modalityAiModal) modalityAiModal.classList.add('open');
                        const descPrompt = `Forne√ßa uma descri√ß√£o concisa e envolvente da modalidade esportiva ${currentModalityName}, para um p√∫blico de jogos estudantis.`;
                        await callGeminiAPI(descPrompt, modalityDescriptionLoading, modalityDescriptionContent, 'descri√ß√£o da modalidade');
                    });
                }

                if (closeModalBtn) closeModalBtn.addEventListener('click', () => modalityAiModal?.classList.remove('open'));
                if (modalityAiModal) modalityAiModal.addEventListener('click', (e) => { if (e.target === modalityAiModal) modalityAiModal.classList.remove('open'); });

                if (generateTrainingPlanBtn) {
                    generateTrainingPlanBtn.addEventListener('click', () => {
                        if (modalityAiResult) modalityAiResult.classList.remove('hidden');
                        const prompt = `Elabore um plano de treinamento b√°sico para atletas escolares de ${currentModalityName} para os JEV'S. Foco em prepara√ß√£o f√≠sica, t√©cnica e t√°tica para 4 semanas. Use negrito para t√≠tulos.`;
                        callGeminiAPI(prompt, modalityAiLoading, modalityAiContent, 'plano de treino');
                    });
                }
                if (viewRulesHistoryBtn) {
                    viewRulesHistoryBtn.addEventListener('click', () => {
                        if (modalityAiResult) modalityAiResult.classList.remove('hidden');
                        const prompt = `Forne√ßa aspectos importantes das regras e um breve hist√≥rico da modalidade ${currentModalityName}, para um contexto de jogos estudantis. Use negrito para t√≠tulos.`;
                        callGeminiAPI(prompt, modalityAiLoading, modalityAiContent, 'regras e hist√≥rico');
                    });
                }

                // --- Info Modal Logic for Student View ---
                const infoModal = document.getElementById('info-modal');
                const closeInfoModalBtn = document.getElementById('close-info-modal-btn');
                const infoModalTitle = document.getElementById('info-modal-title');
                const infoModalContent = document.getElementById('info-modal-content');
                const valuesCardsContainer = document.getElementById('values-cards');
                const principlesWheel = document.getElementById('principles-wheel');

                function openInfoModal(title, description) {
                    if (infoModalTitle) infoModalTitle.textContent = title;
                    if (infoModalContent) infoModalContent.textContent = description;
                    if (infoModal) infoModal.classList.add('open');
                }

                if (valuesCardsContainer) {
                    valuesCardsContainer.addEventListener('click', (e) => {
                        const card = e.target.closest('.value-card');
                        if (card) {
                            openInfoModal(card.dataset.title, card.dataset.description);
                        }
                    });
                }

                if(principlesWheel) {
                    principlesWheel.addEventListener('click', (e) => {
                        const slice = e.target.closest('.principle-slice');
                        if(slice) {
                            openInfoModal(slice.dataset.title, slice.dataset.content);
                        }
                    });
                }

                if (closeInfoModalBtn) {
                    closeInfoModalBtn.addEventListener('click', () => {
                        infoModal.classList.remove('open');
                    });
                }

                if (infoModal) {
                    infoModal.addEventListener('click', (e) => {
                        if (e.target === infoModal) {
                            infoModal.classList.remove('open');
                        }
                    });
                }

                // --- INITIAL RENDER ---
                renderModalities();
            }
        });
    </script>
</body>
</html>
