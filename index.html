<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: "Vilela Esportiva" - Inspirada nos logos da prefeitura (azul marinho, verde-lim√£o) e neutros (branco, cinza claro) para criar uma identidade visual moderna, tecnol√≥gica e ligada ao munic√≠pio. -->
    <!-- Application Structure Plan: A estrutura foi desenhada para priorizar a usabilidade e o acesso r√°pido √† informa√ß√£o, em vez de espelhar a ordem linear do regulamento. A p√°gina √© dividida em se√ß√µes tem√°ticas: 1. Vis√£o Geral (Hero) com um contador regressivo para engajamento e dados chave (datas, modalidades). 2. Modalidades com filtros interativos por categoria, o que √© mais √∫til para t√©cnicos e atletas. 3. Prazos e Inscri√ß√µes em formato de linha do tempo visual. 4. Pontua√ß√£o e Premia√ß√£o, para detalhar os novos sistemas. 5. Regras Essenciais organizadas em um acorde√£o para evitar um bloco de texto massivo. Essa arquitetura orientada √† tarefa facilita a navega√ß√£o e a consulta r√°pida, que s√£o os principais objetivos dos usu√°rios deste tipo de documento. -->
    <!-- Visualization & Content Choices: 1. (Informar) Contador Regressivo: HTML/CSS/JS para criar urg√™ncia e engajamento. 2. (Comparar) Gr√°fico de Modalidades por Categoria: Chart.js (Canvas) para mostrar visualmente a distribui√ß√£o de esportes, facilitando a compreens√£o da oferta. 3. (Organizar) Filtro de Modalidades: HTML/CSS/JS para permitir que os usu√°rios vejam apenas os esportes de seu interesse, melhorando a usabilidade. 4. (Organizar) Linha do Tempo de Prazos: HTML/CSS para apresentar datas cr√≠ticas de forma mais visual e f√°cil de seguir. 5. (Organizar) Acorde√£o de Regras: HTML/CSS/JS para agrupar regras complexas em t√≥picos clic√°veis, tornando a informa√ß√£o menos intimidante. 6. (Gerar Conte√∫do Espec√≠fico) Plano de Treinamento/Regras e Hist√≥rico por Modalidade: Chamada √† API Gemini para gerar conte√∫do detalhado ao clicar em uma modalidade. 7. (Orientar/Apoiar) Dicas de Treino e Alimenta√ß√£o: Chamada √† API Gemini para gerar conselhos pr√°ticos para esportes espec√≠ficos. 8. (Aprofundar) Explicar Regra em Detalhe: Chamada √† API Gemini para fornecer explica√ß√µes aprofundadas de regras. 9. (Detalhar Modalidade) Visualizar Detalhes da Modalidade: Ao clicar no card da modalidade, um modal exibe informa√ß√µes est√°ticas e uma descri√ß√£o gerada por IA. Justificativa: todas as escolhas visam transformar um documento denso em uma ferramenta de consulta r√°pida e interativa, adicionando valor com IA generativa e contextualizada para os p√∫blicos-alvo. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>JEV'S 2025 - Regulamento Interativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .brand-gradient {
            background: linear-gradient(90deg, #1e3a8a, #4f46e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body class="text-slate-700">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                 <div class="w-8 h-8 bg-blue-800 rounded-full flex items-center justify-center text-white font-bold text-lg">
                    J
                 </div>
                 <span class="text-xl font-bold text-slate-800">JEV'S 2025</span>
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#overview" class="hover:text-blue-700 transition">Vis√£o Geral</a>
                <a href="#modalities" class="hover:text-blue-700 transition">Modalidades</a>
                <a href="#timeline" class="hover:text-blue-700 transition">Prazos</a>
                <a href="#scoring" class="hover:text-blue-700 transition">Pontua√ß√£o</a>
                <a href="#rules" class="hover:text-blue-700 transition">Regras</a>
            </div>
            <a href="#timeline" class="hidden md:block bg-blue-700 text-white px-5 py-2 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20">
                Inscreva-se
            </a>
            <button id="mobile-menu-button" class="md:hidden text-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#overview" class="block py-2 hover:text-blue-700">Vis√£o Geral</a>
            <a href="#modalities" class="block py-2 hover:text-blue-700">Modalidades</a>
            <a href="#timeline" class="block py-2 hover:text-blue-700">Prazos</a>
            <a href="#scoring" class="block py-2 hover:text-blue-700">Pontua√ß√£o</a>
            <a href="#rules" class="block py-2 hover:text-blue-700">Regras</a>
            <a href="#timeline" class="block mt-2 bg-blue-700 text-white text-center px-5 py-2 rounded-full hover:bg-blue-800 transition">
                Inscreva-se
            </a>
        </div>
    </header>

    <main class="container mx-auto px-6">

        <!-- Overview Section -->
        <section id="overview" class="py-20 md:py-28 text-center">
            <h1 class="text-4xl md:text-6xl font-black mb-4"><span class="brand-gradient">Jogos Estudantis Vilelenses</span> 2025</h1>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto mb-8">O maior evento de esporte escolar de Teot√¥nio Vilela est√° chegando! Prepare sua equipe para a XV Edi√ß√£o dos jogos.</p>

            <div id="countdown" class="flex justify-center space-x-4 md:space-x-8 text-center my-12">
                <div>
                    <div id="days" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div>
                    <div class="text-sm font-semibold text-slate-500 mt-2">DIAS</div>
                </div>
                <div>
                    <div id="hours" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div>
                    <div class="text-sm font-semibold text-slate-500 mt-2">HORAS</div>
                </div>
                <div>
                    <div id="minutes" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div>
                    <div class="text-sm font-semibold text-slate-500 mt-2">MINUTOS</div>
                </div>
                <div>
                    <div id="seconds" class="text-4xl md:text-6xl font-bold text-blue-800 bg-white shadow-xl rounded-2xl p-4 min-w-[80px]">00</div>
                    <div class="text-sm font-semibold text-slate-500 mt-2">SEGUNDOS</div>
                </div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto text-left mt-16">
                <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
                    <h3 class="font-bold text-lg text-slate-800 mb-2">üóìÔ∏è Datas do Evento</h3>
                    <p class="text-slate-600">01 a 10 de Setembro de 2025</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
                    <h3 class="font-bold text-lg text-slate-800 mb-2">üèÜ Modalidades</h3>
                    <p class="text-slate-600">15 modalidades coletivas e individuais.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-md border border-slate-100">
                    <h3 class="font-bold text-lg text-slate-800 mb-2">üìç Local Principal</h3>
                    <p class="text-slate-600">Gin√°sio Poliesportivo "O Senadinho" e outros locais a definir.</p>
                </div>
            </div>

            <div class="mt-16 max-w-4xl mx-auto">
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 mb-8">
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">‚ú® Dicas de Treino e Alimenta√ß√£o</h3>
                    <p class="text-slate-600 mb-4">Obtenha sugest√µes de treino e alimenta√ß√£o para melhorar capacidades espec√≠ficas no seu esporte.</p>
                    <input type="text" id="sport-input" placeholder="Ex: Futsal, Atletismo, Nata√ß√£o..." class="w-full p-3 border border-slate-300 rounded-lg mb-4 bg-white text-slate-700 focus:ring-blue-500 focus:border-blue-500">
                    <button id="generate-training-nutrition-tips-btn" class="w-full bg-blue-700 text-white px-6 py-3 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">
                        Gerar Dicas Personalizadas
                    </button>
                    <div id="training-nutrition-tips-result" class="mt-4 p-4 bg-blue-50/50 rounded-lg hidden">
                        <p id="training-nutrition-tips-loading" class="text-slate-500 italic"></p>
                        <div id="training-nutrition-tips-content" class="text-slate-700 text-left"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modalities Section -->
        <section id="modalities" class="py-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Modalidades e Categorias</h2>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Explore as modalidades dispon√≠veis. Use os filtros para ver as op√ß√µes para cada categoria. Clique em uma modalidade para gerar um plano de treinamento ou ver detalhes de regras/hist√≥rico.</p>
            </div>

            <div class="flex justify-center space-x-2 md:space-x-4 mb-8 flex-wrap gap-2" id="category-filters">
                <button data-category="all" class="category-btn bg-blue-700 text-white px-5 py-2 rounded-full font-semibold transition">Todas</button>
                <button data-category="mirim" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Mirim</button>
                <button data-category="infantil" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Infantil</button>
                <button data-category="juvenil" class="category-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold transition hover:bg-slate-100">Juvenil</button>
            </div>

            <div id="modalities-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Modalities will be injected here by JS -->
            </div>
            
            <div class="mt-20">
                 <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-slate-800">Distribui√ß√£o de Esportes por Categoria</h3>
                    <p class="text-slate-600 mt-2">Visualiza√ß√£o r√°pida do n√∫mero de modalidades em cada categoria.</p>
                </div>
                <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg">
                    <div class="chart-container">
                        <canvas id="modalitiesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Timeline Section -->
        <section id="timeline" class="py-20">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Prazos e Inscri√ß√µes</h2>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Fique atento √†s datas mais importantes do JEV'S 2025. N√£o perca os prazos!</p>
            </div>
            <div class="relative max-w-4xl mx-auto">
                <div class="absolute left-1/2 -translate-x-1/2 h-full w-1 bg-blue-200 rounded-full"></div>
                
                <div class="relative mb-8">
                    <div class="flex items-center justify-start md:justify-end md:mr-8">
                        <div class="w-full md:w-1/2 md:text-right p-4">
                            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                                <p class="text-sm font-semibold text-blue-600">08 de Agosto de 2025</p>
                                <h3 class="text-xl font-bold my-1">I Congresso T√©cnico</h3>
                                <p class="text-slate-600">Apresenta√ß√£o do regulamento geral e espec√≠fico das modalidades.</p>
                            </div>
                        </div>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-blue-700 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">1</div>
                </div>

                <div class="relative mb-8">
                    <div class="flex items-center justify-start md:ml-8">
                        <div class="w-full md:w-1/2 p-4">
                            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                                <p class="text-sm font-semibold text-green-600">29 de Julho a 07 de Agosto de 2025</p>
                                <h3 class="text-xl font-bold my-1">Per√≠odo de Inscri√ß√µes</h3>
                                <p class="text-slate-600">Inscri√ß√£o das equipes e atletas atrav√©s do site oficial do evento. Atendimento e suporte no Audit√≥rio da SEMED a partir das 8h30.</p>
                                <a href="https://sites.google.com/view/jogosestudantisvilelenses/" target="_blank" class="inline-block mt-3 text-blue-700 font-semibold hover:underline">Acessar Site ‚Üí</a>
                            </div>
                        </div>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-green-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">2</div>
                </div>

                <div class="relative">
                    <div class="flex items-center justify-start md:justify-end md:mr-8">
                        <div class="w-full md:w-1/2 md:text-right p-4">
                           <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100">
                                <p class="text-sm font-semibold text-purple-600">01 a 10 de Setembro de 2025</p>
                                <h3 class="text-xl font-bold my-1">Realiza√ß√£o dos Jogos</h3>
                                <p class="text-slate-600">Abertura no dia 01/09, seguida pelas competi√ß√µes em todas as modalidades.</p>
                            </div>
                        </div>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-8 h-8 bg-purple-600 rounded-full border-4 border-white flex items-center justify-center text-white font-bold">3</div>
                </div>

            </div>
        </section>

        <!-- Scoring Section -->
        <section id="scoring" class="py-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Pontua√ß√£o e Premia√ß√£o</h2>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Entenda como as institui√ß√µes e atletas s√£o pontuados e premiados nos JEV'S 2025.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">Crit√©rios de Pontua√ß√£o da Modalidade (Art. 56)</h3>
                    <p class="text-slate-600 mb-4">A pontua√ß√£o das institui√ß√µes para o quadro geral √© diferente para modalidades individuais/lutas e coletivas:</p>
                    <div class="mb-6">
                        <h4 class="font-bold text-lg text-blue-700 mb-2">Modalidades Individuais e Lutas:</h4>
                        <ul class="list-disc list-inside text-slate-600">
                            <li>Medalha de Ouro: **3 pontos**</li>
                            <li>Medalha de Prata: **2 pontos**</li>
                            <li>Medalha de Bronze: **1 ponto**</li>
                        </ul>
                        <p class="text-sm text-slate-500 mt-2">A pontua√ß√£o final da institui√ß√£o √© o somat√≥rio de todas as medalhas conquistadas.</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-green-600 mb-2">Modalidades Coletivas:</h4>
                        <ul class="list-disc list-inside text-slate-600">
                            <li>1¬∫ Lugar: **10 pontos**</li>
                            <li>2¬∫ Lugar: **7 pontos**</li>
                            <li>3¬∫ Lugar: **5 pontos**</li>
                        </ul>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">Classifica√ß√£o Geral e por Categoria (Art. 55)</h3>
                    <p class="text-slate-600 mb-4">A classifica√ß√£o das institui√ß√µes √© feita pelo somat√≥rio dos pontos obtidos em todas as modalidades, g√™neros e categorias.</p>
                    <h4 class="font-bold text-lg text-blue-700 mb-2">Crit√©rios de Desempate (Art. 55, ¬ß 3¬∫):</h4>
                    <ol class="list-decimal list-inside text-slate-600 space-y-1">
                        <li>Maior n√∫mero de primeiros lugares (Ouro);</li>
                        <li>Maior n√∫mero de segundos lugares (Prata);</li>
                        <li>Maior n√∫mero de terceiros lugares (Bronze);</li>
                        <li>Maior n√∫mero total de atletas participantes na competi√ß√£o;</li>
                        <li>Persistindo o empate, a decis√£o ser√° por sorteio.</li>
                    </ol>
                    <h4 class="font-bold text-lg text-slate-800 mt-6 mb-2">Premia√ß√£o (Art. 57 e 59):</h4>
                    <p class="text-slate-600">Trof√©us para as institui√ß√µes campe√£s (geral e por categoria) e medalhas para os alunos-atletas e t√©cnicos (1¬∫, 2¬∫ e 3¬∫ lugares) em cada modalidade, g√™nero e categoria.</p>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 mt-8 max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold text-slate-800 mb-4">Regra de Pontua√ß√£o M√≠nima da Modalidade (Art. 54)</h3>
                <p class="text-slate-600 mb-4">Para que uma modalidade (g√™nero e categoria) possa pontuar para a classifica√ß√£o geral das Institui√ß√µes de Ensino, ela dever√° estar presente em pelo menos **50% do total de Institui√ß√µes de Ensino inscritas** no JEV'S 2025.</p>
                <p class="text-slate-600 mb-4">Caso n√£o atinja esse percentual para a classifica√ß√£o geral, a modalidade poder√° pontuar na **classifica√ß√£o da sua respectiva categoria** (Mirim, Infantil ou Juvenil), desde que atinja o m√≠nimo de **50% do total de Institui√ß√µes de Ensino que tenham equipes ou atletas inscritos naquela categoria espec√≠fica.**</p>
                <p class="text-slate-600">Se a modalidade n√£o atingir nenhum dos percentuais m√≠nimos para pontua√ß√£o, as disputas ainda ser√£o realizadas (com m√≠nimo de 3 institui√ß√µes inscritas), mas seus resultados **n√£o ser√£o considerados** para a pontua√ß√£o geral nem por categoria, servindo apenas para participa√ß√£o e desenvolvimento esportivo.</p>
            </div>
        </section>

        <!-- Rules Section -->
        <section id="rules" class="py-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Regras Essenciais</h2>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto mt-4">Um resumo dos pontos mais importantes do regulamento para consulta r√°pida.</p>
            </div>
            <div class="max-w-4xl mx-auto space-y-4" id="accordion">
                <!-- Accordion items will be injected here by JS -->
            </div>

            <div class="max-w-4xl mx-auto mt-16 bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                <h3 class="text-2xl font-bold text-slate-800 mb-4">‚ú® Explicar Regra em Detalhe com IA</h3>
                <p class="text-slate-600 mb-4">Selecione uma regra para obter uma explica√ß√£o mais aprofundada, ideal para professores e t√©cnicos.</p>
                <select id="rule-elaborate-selector" class="w-full p-3 border border-slate-300 rounded-lg mb-4 bg-white text-slate-700 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Selecione um t√≥pico...</option>
                </select>
                <button id="elaborate-rule-btn" class="w-full bg-blue-700 text-white px-6 py-3 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">
                    Gerar Explica√ß√£o Detalhada
                </button>
                <div id="rule-elaborate-result" class="mt-4 p-4 bg-blue-50/50 rounded-lg hidden">
                    <p id="rule-elaborate-loading" class="text-slate-500 italic"></p>
                    <div id="rule-elaborate-content" class="text-slate-700 text-left"></div>
                </div>
            </div>

            <div class="max-w-4xl mx-auto mt-8 bg-white p-8 rounded-2xl shadow-lg border border-slate-100">
                <h3 class="text-2xl font-bold text-slate-800 mb-4">‚ú® Resumir Regra com IA (para Alunos)</h3>
                <p class="text-slate-600 mb-4">Selecione uma regra para obter um resumo conciso e f√°cil de entender, ideal para atletas.</p>
                <select id="rule-summary-selector" class="w-full p-3 border border-slate-300 rounded-lg mb-4 bg-white text-slate-700 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Selecione um t√≥pico...</option>
                </select>
                <button id="summarize-rule-btn" class="w-full bg-blue-700 text-white px-6 py-3 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">
                    Gerar Resumo Simples
                </button>
                <div id="rule-summary-result" class="mt-4 p-4 bg-blue-50/50 rounded-lg hidden">
                    <p id="rule-summary-loading" class="text-slate-500 italic"></p>
                    <div id="rule-summary-content" class="text-slate-700 text-left"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modality AI Modal -->
    <div id="modality-ai-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 id="modal-modality-name" class="text-2xl font-bold text-slate-800 mb-6 text-center"></h3>
            
            <div id="modality-static-details" class="mb-6 text-center text-slate-600">
                <!-- Icon, categories, type, athletes will go here -->
            </div>

            <div id="modality-description-area" class="mb-6">
                <p id="modality-description-loading" class="text-slate-500 italic text-center"></p>
                <div id="modality-description-content" class="text-slate-700 text-left"></div>
            </div>

            <div class="flex justify-center space-x-4 mb-6 flex-wrap gap-2">
                <button id="generate-training-plan-btn" class="bg-blue-700 text-white px-5 py-2 rounded-full hover:bg-blue-800 transition shadow-lg shadow-blue-500/20 flex items-center justify-center">
                    Elaborar Plano de Treinamento
                </button>
                <button id="view-rules-history-btn" class="bg-green-600 text-white px-5 py-2 rounded-full hover:bg-green-700 transition shadow-lg shadow-green-600/20 flex items-center justify-center">
                    Ver Regras e Hist√≥rico
                </button>
            </div>

            <div id="modality-ai-result" class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                <p id="modality-ai-loading" class="text-slate-500 italic text-center"></p>
                <div id="modality-ai-content" class="text-slate-700 text-left"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-300 mt-20">
        <div class="container mx-auto px-6 py-8 text-center">
            <p>&copy; 2025 Prefeitura Municipal de Teot√¥nio Vilela - Secretaria de Educa√ß√£o.</p>
            <p class="text-sm text-slate-400 mt-2">Desenvolvido para facilitar o acesso √† informa√ß√£o dos JEV'S 2025.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- DATA ---
            const modalities = [
                { name: 'Atletismo', icon: 'üèÉ', type: 'Individual', athletes: '15-21 por g√™nero', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Basquete', icon: 'üèÄ', type: 'Coletivo', athletes: 'At√© 10', categories: ['infantil', 'juvenil'] },
                { name: 'Basquete 3x3', icon: 'üèÄ', type: 'Coletivo', athletes: 'At√© 4', categories: ['infantil', 'juvenil'] },
                { name: 'Capoeira', icon: 'ü§∏', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Cubo M√°gico', icon: 'üßä', type: 'Individual', athletes: 'At√© 4', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Futsal', icon: '‚öΩ', type: 'Coletivo', athletes: 'At√© 10', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Futev√¥lei', icon: 'üèê', type: 'Individual/Dupla', athletes: '2 duplas', categories: ['infantil', 'juvenil'] },
                { name: 'V√¥lei de praia', icon: 'üèñÔ∏è', type: 'Dupla', athletes: '2 duplas', categories: ['infantil', 'juvenil'] },
                { name: 'Handebol', icon: 'ü§æ', type: 'Coletivo', athletes: 'At√© 12', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Jiu-Jitsu', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Karat√™', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Queimado', icon: 'üéØ', type: 'Coletivo', athletes: 'At√© 12', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Xadrez', icon: '‚ôüÔ∏è', type: 'Individual', athletes: 'At√© 4', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Jud√¥', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Taekwondo', icon: 'ü•ã', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['mirim', 'infantil', 'juvenil'] },
                { name: 'Wrestling', icon: 'ü§º', type: 'Luta', athletes: 'Vari√°vel (peso/idade)', categories: ['infantil', 'juvenil'] },
            ];

            const rules = [
                {
                    title: "Composi√ß√£o das Equipes (Art. 17)",
                    content: "Cada equipe pode ter at√© 14 participantes, sendo 12 atletas e 2 t√©cnicos/auxiliares. A equipe de gest√£o (diretor/coordenador) pode ter at√© 2 membros inscritos, que podem ficar no banco de reservas e se responsabilizar pela equipe na aus√™ncia do t√©cnico."
                },
                {
                    title: "Condi√ß√£o de Participa√ß√£o (Art. 21-27)",
                    content: "Podem participar alunos de 9 a 17 anos, regularmente matriculados. Cada atleta pode competir em at√© 3 modalidades (2 individuais e 1 coletiva). √â obrigat√≥ria a presen√ßa de um respons√°vel (t√©cnico, auxiliar ou gestor) inscrito na s√∫mula durante os jogos."
                },
                {
                    title: "Sistema de Competi√ß√£o (Art. 37-45)",
                    content: "As competi√ß√µes s√≥ ocorrem com no m√≠nimo 3 institui√ß√µes inscritas. O sistema de disputa (rod√≠zio, cruzamento, etc.) varia conforme o n√∫mero de equipes. Os detalhes e chaveamentos s√£o definidos no Congresso T√©cnico. Equipes podem jogar mais de uma vez por dia, com intervalo m√≠nimo de 2 horas."
                },
                {
                    title: "Regra de W.O. (Art. 47)",
                    content: "A toler√¢ncia de atraso √© de 15 minutos para a primeira partida do dia. Para as demais, a toler√¢ncia √© de 5 minutos. O W.O. n√£o elimina a equipe em fases de rod√≠zio, mas o caso √© encaminhado √† Comiss√£o Disciplinar. O placar do W.O. varia por modalidade (ex: Futsal 1x0, Basquete 20x0)."
                },
                {
                    title: "Uniformes (Art. 60-63)",
                    content: "As equipes devem se apresentar devidamente uniformizadas. Em caso de uniformes com cores coincidentes, um sorteio definir√° qual equipe usar√° os coletes fornecidos pela organiza√ß√£o. A comiss√£o t√©cnica tamb√©m deve estar vestida adequadamente (camisa, cal√ßa/bermuda e cal√ßado fechado)."
                },
                {
                    title: "Protestos (Art. 65-68)",
                    content: "Protestos devem ser formalizados em formul√°rio pr√≥prio e entregues at√© as 20:00h do dia do fato via link oficial, ou presencialmente at√© as 18:00h. O reclamante deve apresentar provas materiais. Protestos infundados ser√£o analisados pela Comiss√£o Disciplinar."
                },
                {
                    title: "Pontua√ß√£o M√≠nima da Modalidade (Art. 54)",
                    content: "Para pontuar na classifica√ß√£o geral, a modalidade (g√™nero e categoria) deve ter pelo menos 50% das institui√ß√µes inscritas no JEV'S. Se n√£o atingir, pode pontuar na categoria espec√≠fica se tiver 50% das institui√ß√µes inscritas naquela categoria. Se n√£o atingir nenhum, a disputa √© s√≥ para participa√ß√£o (m√≠nimo 3 institui√ß√µes), sem pontua√ß√£o."
                }
            ];

            // --- MOBILE MENU ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // --- COUNTDOWN ---
            const countdownElement = document.getElementById('countdown');
            if(countdownElement) {
                const eventDate = new Date('2025-09-01T10:00:00').getTime(); // Updated to 10:00 AM

                const updateCountdown = () => {
                    const now = new Date().getTime();
                    const distance = eventDate - now;

                    if (distance < 0) {
                        document.getElementById('countdown').innerHTML = `<div class="text-2xl font-bold text-green-600 bg-white/80 p-6 rounded-2xl shadow-lg">O JEV'S 2025 j√° come√ßou!</div>`;
                        return;
                    }

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    document.getElementById('days').innerText = String(days).padStart(2, '0');
                    document.getElementById('hours').innerText = String(hours).padStart(2, '0');
                    document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
                    document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
                };

                setInterval(updateCountdown, 1000);
                updateCountdown();
            }

            // --- MODALITIES FILTERING ---
            const modalitiesGrid = document.getElementById('modalities-grid');
            const categoryFilters = document.getElementById('category-filters');
            const categoryButtons = categoryFilters ? categoryFilters.querySelectorAll('.category-btn') : [];

            const renderModalities = (category = 'all') => {
                if (!modalitiesGrid) return; // Null check
                modalitiesGrid.innerHTML = '';
                const filteredModalities = category === 'all'
                    ? modalities
                    : modalities.filter(m => m.categories.includes(category));
                
                filteredModalities.forEach(mod => {
                    const card = document.createElement('div');
                    card.className = `modality-card bg-white p-6 rounded-2xl shadow-md border border-slate-100 transform hover:-translate-y-1 transition duration-300 flex flex-col items-center text-center cursor-pointer`;
                    card.dataset.categories = mod.categories.join(' ');
                    card.dataset.modalityName = mod.name; // Store modality name for AI features
                    card.dataset.modalityIcon = mod.icon;
                    card.dataset.modalityType = mod.type;
                    card.dataset.modalityAthletes = mod.athletes;


                    card.innerHTML = `
                        <div class="text-5xl mb-4">${mod.icon}</div>
                        <h4 class="font-bold text-lg text-slate-800 flex-grow">${mod.name}</h4>
                        <div class="flex space-x-2 mt-4">
                            ${mod.categories.includes('mirim') ? '<span class="bg-yellow-200 text-yellow-800 text-xs font-semibold px-2 py-1 rounded-full">Mirim</span>' : ''}
                            ${mod.categories.includes('infantil') ? '<span class="bg-green-200 text-green-800 text-xs font-semibold px-2 py-1 rounded-full">Infantil</span>' : ''}
                            ${mod.categories.includes('juvenil') ? '<span class="bg-blue-200 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full">Juvenil</span>' : ''}
                        </div>
                    `;
                    modalitiesGrid.appendChild(card);
                });
            };

            if (categoryFilters) { // Null check
                categoryFilters.addEventListener('click', (e) => {
                    if (e.target.classList.contains('category-btn')) {
                        const selectedCategory = e.target.dataset.category;
                        
                        categoryButtons.forEach(btn => {
                            btn.classList.remove('bg-blue-700', 'text-white');
                            btn.classList.add('bg-white', 'text-slate-700');
                        });
                        
                        e.target.classList.add('bg-blue-700', 'text-white');
                        e.target.classList.remove('bg-white', 'text-slate-700');

                        renderModalities(selectedCategory);
                    }
                });
            }

            // --- ACCORDION ---
            const accordion = document.getElementById('accordion');
            if (accordion) { // Null check
                rules.forEach((rule, index) => {
                    const item = document.createElement('div');
                    item.className = 'bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden';
                    item.innerHTML = `
                        <button class="accordion-toggle w-full flex justify-between items-center p-6 text-left font-semibold text-slate-800 hover:bg-slate-50 transition">
                            <span>${rule.title}</span>
                            <svg class="accordion-icon w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                            <div class="p-6 pt-0 text-slate-600">
                                <p>${rule.content}</p>
                            </div>
                        </div>
                    `;
                    accordion.appendChild(item);
                });
                
                accordion.addEventListener('click', (e) => {
                    const toggle = e.target.closest('.accordion-toggle');
                    if (toggle) {
                        const content = toggle.nextElementSibling;
                        const icon = toggle.querySelector('.accordion-icon');
                        
                        // Close all others
                        document.querySelectorAll('.accordion-content').forEach(el => {
                            if (el !== content) {
                                el.style.maxHeight = null;
                                const otherIcon = el.previousElementSibling ? el.previousElementSibling.querySelector('.accordion-icon') : null;
                                if (otherIcon) otherIcon.classList.remove('rotate-180');
                            }
                        });

                        // Toggle current
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null;
                            icon.classList.remove('rotate-180');
                        } else {
                            content.style.maxHeight = content.scrollHeight + "px";
                            icon.classList.add('rotate-180');
                        }
                    }
                });
            }


            // --- MODALITIES CHART ---
            const mirimCount = modalities.filter(m => m.categories.includes('mirim')).length;
            const infantilCount = modalities.filter(m => m.categories.includes('infantil')).length;
            const juvenilCount = modalities.filter(m => m.categories.includes('juvenil')).length;

            const ctx = document.getElementById('modalitiesChart');
            if (ctx) { // Null check
                new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Mirim (9-11 anos)', 'Infantil (12-14 anos)', 'Juvenil (15-17 anos)'],
                        datasets: [{
                            label: 'N¬∫ de Modalidades',
                            data: [mirimCount, infantilCount, juvenilCount],
                            backgroundColor: [
                                'rgba(253, 224, 71, 0.6)', // yellow-300
                                'rgba(74, 222, 128, 0.6)', // green-400
                                'rgba(96, 165, 250, 0.6)'  // blue-400
                            ],
                            borderColor: [
                                'rgba(253, 224, 71, 1)',
                                'rgba(74, 222, 128, 1)',
                                'rgba(96, 165, 250, 1)'
                            ],
                            borderWidth: 1,
                            borderRadius: 8,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: '#1e293b', // slate-800
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 12 },
                                padding: 12,
                                cornerRadius: 8,
                                displayColors: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#e2e8f0' // slate-200
                                },
                                ticks: {
                                    color: '#475569' // slate-600
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#475569' // slate-600
                                }
                            }
                        }
                    }
                });
            }


            // --- LLM INTEGRATIONS ---
            const generateOpeningIdeasBtn = document.getElementById('generate-opening-ideas-btn');
            const openingIdeasResult = document.getElementById('opening-ideas-result');
            const openingIdeasLoading = document.getElementById('opening-ideas-loading');
            const openingIdeasContent = document.getElementById('opening-ideas-content');

            if (generateOpeningIdeasBtn) { // Null check
                generateOpeningIdeasBtn.addEventListener('click', async () => {
                    if (openingIdeasResult) openingIdeasResult.classList.remove('hidden');
                    if (openingIdeasLoading) openingIdeasLoading.textContent = 'Gerando ideias... Por favor, aguarde.';
                    if (openingIdeasContent) openingIdeasContent.innerHTML = '';

                    const prompt = "Gere 3 ideias criativas para a cerim√¥nia de abertura dos Jogos Estudantis Vilelenses (JEV'S 2025), considerando que √© um evento escolar que celebra esporte, educa√ß√£o e uni√£o. Inclua sugest√µes para tema, atividades e um breve discurso inspirador para cada ideia. Formate a resposta com t√≥picos claros para cada ideia.";
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (openingIdeasContent) openingIdeasContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (openingIdeasLoading) openingIdeasLoading.textContent = '';
                        } else {
                            if (openingIdeasLoading) openingIdeasLoading.textContent = `N√£o foi poss√≠vel gerar ideias. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para ideias de abertura:', error);
                        if (openingIdeasLoading) openingIdeasLoading.textContent = 'Erro ao gerar ideias. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }

            const generateTrainingNutritionTipsBtn = document.getElementById('generate-training-nutrition-tips-btn');
            const sportInput = document.getElementById('sport-input');
            const trainingNutritionTipsResult = document.getElementById('training-nutrition-tips-result');
            const trainingNutritionTipsLoading = document.getElementById('training-nutrition-tips-loading');
            const trainingNutritionTipsContent = document.getElementById('training-nutrition-tips-content');

            if (generateTrainingNutritionTipsBtn && sportInput) { // Null checks
                generateTrainingNutritionTipsBtn.addEventListener('click', async () => {
                    const sportName = sportInput.value.trim();
                    if (!sportName) {
                        if (trainingNutritionTipsResult) trainingNutritionTipsResult.classList.remove('hidden');
                        if (trainingNutritionTipsLoading) trainingNutritionTipsLoading.textContent = '';
                        if (trainingNutritionTipsContent) trainingNutritionTipsContent.innerHTML = '<p class="text-red-500">Por favor, digite o nome de um esporte.</p>';
                        return;
                    }

                    if (trainingNutritionTipsResult) trainingNutritionTipsResult.classList.remove('hidden');
                    if (trainingNutritionTipsLoading) trainingNutritionTipsLoading.textContent = `Gerando dicas de treino e alimenta√ß√£o para ${sportName}... Por favor, aguarde.`;
                    if (trainingNutritionTipsContent) trainingNutritionTipsContent.innerHTML = '';

                    const prompt = `Gere dicas de treino e alimenta√ß√£o para atletas escolares de ${sportName} que desejam melhorar capacidades espec√≠ficas e otimizar seu desempenho. Inclua sugest√µes para treino (ex: for√ßa, velocidade, resist√™ncia, t√©cnica) e alimenta√ß√£o (ex: pr√©-treino, p√≥s-treino, hidrata√ß√£o). Formate a resposta com t√≥picos claros.`;
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (trainingNutritionTipsContent) trainingNutritionTipsContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (trainingNutritionTipsLoading) trainingNutritionTipsLoading.textContent = '';
                        } else {
                            if (trainingNutritionTipsLoading) trainingNutritionTipsLoading.textContent = `N√£o foi poss√≠vel gerar as dicas. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para dicas de treino e alimenta√ß√£o:', error);
                        if (trainingNutritionTipsLoading) trainingNutritionTipsLoading.textContent = 'Erro ao gerar dicas. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }


            const ruleElaborateSelector = document.getElementById('rule-elaborate-selector');
            const elaborateRuleBtn = document.getElementById('elaborate-rule-btn');
            const ruleElaborateResult = document.getElementById('rule-elaborate-result');
            const ruleElaborateLoading = document.getElementById('rule-elaborate-loading');
            const ruleElaborateContent = document.getElementById('rule-elaborate-content');

            if (ruleElaborateSelector) { // Null check
                // Populate rule elaborate selector
                rules.forEach((rule, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = rule.title;
                    ruleElaborateSelector.appendChild(option);
                });
            }

            if (elaborateRuleBtn) { // Null check
                elaborateRuleBtn.addEventListener('click', async () => {
                    const selectedIndex = ruleElaborateSelector ? ruleElaborateSelector.value : "";
                    if (selectedIndex === "") {
                        if (ruleElaborateResult) ruleElaborateResult.classList.remove('hidden');
                        if (ruleElaborateLoading) ruleElaborateLoading.textContent = '';
                        if (ruleElaborateContent) ruleElaborateContent.innerHTML = '<p class="text-red-500">Por favor, selecione um t√≥pico de regra para detalhar.</p>';
                        return;
                    }

                    const ruleContent = rules[selectedIndex].content;
                    const ruleTitle = rules[selectedIndex].title;

                    if (ruleElaborateResult) ruleElaborateResult.classList.remove('hidden');
                    if (ruleElaborateLoading) ruleElaborateLoading.textContent = 'Gerando explica√ß√£o detalhada... Por favor, aguarde.';
                    if (ruleElaborateContent) ruleElaborateContent.innerHTML = '';

                    const prompt = `Explique em detalhes a regra sobre '${ruleTitle}' do regulamento dos Jogos Estudantis Vilelenses, considerando o contexto de um professor ou t√©cnico. A regra original √©: '${ruleContent.replace(/<[^>]*>?/gm, '')}'. D√™ exemplos pr√°ticos se poss√≠vel. Formate a resposta de forma clara e did√°tica.`; 
                    
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (ruleElaborateContent) ruleElaborateContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (ruleElaborateLoading) ruleElaborateLoading.textContent = '';
                        } else {
                            if (ruleElaborateLoading) ruleElaborateLoading.textContent = `N√£o foi poss√≠vel gerar a explica√ß√£o. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para detalhamento de regra:', error);
                        if (ruleElaborateLoading) ruleElaborateLoading.textContent = 'Erro ao gerar explica√ß√£o. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }

            const ruleSummarySelector = document.getElementById('rule-summary-selector');
            const summarizeRuleBtn = document.getElementById('summarize-rule-btn');
            const ruleSummaryResult = document.getElementById('rule-summary-result');
            const ruleSummaryLoading = document.getElementById('rule-summary-loading');
            const ruleSummaryContent = document.getElementById('rule-summary-content');

            if (ruleSummarySelector) { // Null check
                // Populate rule summary selector
                rules.forEach((rule, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = rule.title;
                    ruleSummarySelector.appendChild(option);
                });
            }

            if (summarizeRuleBtn) { // Null check
                summarizeRuleBtn.addEventListener('click', async () => {
                    const selectedIndex = ruleSummarySelector ? ruleSummarySelector.value : "";
                    if (selectedIndex === "") {
                        if (ruleSummaryResult) ruleSummaryResult.classList.remove('hidden');
                        if (ruleSummaryLoading) ruleSummaryLoading.textContent = '';
                        if (ruleSummaryContent) ruleSummaryContent.innerHTML = '<p class="text-red-500">Por favor, selecione um t√≥pico de regra para resumir.</p>';
                        return;
                    }

                    const ruleContent = rules[selectedIndex].content;
                    const ruleTitle = rules[selectedIndex].title;

                    if (ruleSummaryResult) ruleSummaryResult.classList.remove('hidden');
                    if (ruleSummaryLoading) ruleSummaryLoading.textContent = 'Gerando resumo... Por favor, aguarde.';
                    if (ruleSummaryContent) ruleSummaryContent.innerHTML = '';

                    const prompt = `Resuma a seguinte regra dos Jogos Estudantis Vilelenses (JEV'S 2025) de forma concisa e clara para um atleta, focando nos pontos mais importantes. O t√≠tulo da regra √© "${ruleTitle}". O conte√∫do completo √©: "${ruleContent.replace(/<[^>]*>?/gm, '')}"`; // Remove HTML tags from content
                    
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (ruleSummaryContent) ruleSummaryContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (ruleSummaryLoading) ruleSummaryLoading.textContent = '';
                        } else {
                            if (ruleSummaryLoading) ruleSummaryLoading.textContent = `N√£o foi poss√≠vel gerar o resumo. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para resumo de regra:', error);
                        if (ruleSummaryLoading) ruleSummaryLoading.textContent = 'Erro ao gerar o resumo. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }

            // --- Modality AI Modal Logic ---
            const modalityAiModal = document.getElementById('modality-ai-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalModalityName = document.getElementById('modal-modality-name');
            const generateTrainingPlanBtn = document.getElementById('generate-training-plan-btn');
            const viewRulesHistoryBtn = document.getElementById('view-rules-history-btn');
            const modalityAiResult = document.getElementById('modality-ai-result');
            const modalityAiLoading = document.getElementById('modality-ai-loading');
            const modalityAiContent = document.getElementById('modality-ai-content');
            const modalityStaticDetails = document.getElementById('modality-static-details');
            const modalityDescriptionArea = document.getElementById('modality-description-area');
            const modalityDescriptionLoading = document.getElementById('modality-description-loading');
            const modalityDescriptionContent = document.getElementById('modality-description-content');


            let currentModalityName = ''; // To store the name of the modality clicked

            // Event delegation for modality cards
            if (modalitiesGrid) { // Null check for modalitiesGrid
                modalitiesGrid.addEventListener('click', async (e) => {
                    const card = e.target.closest('.modality-card');
                    if (!card) return; // Not a modality card click

                    currentModalityName = card.dataset.modalityName;
                    const modalityIcon = card.dataset.modalityIcon;
                    const modalityType = card.dataset.modalityType;
                    const modalityAthletes = card.dataset.modalityAthletes;
                    const modalityCategories = card.dataset.categories.split(' ').map(cat => {
                        let colorClass = '';
                        if (cat === 'mirim') colorClass = 'bg-yellow-200 text-yellow-800';
                        else if (cat === 'infantil') colorClass = 'bg-green-200 text-green-800';
                        else if (cat === 'juvenil') colorClass = 'bg-blue-200 text-blue-800';
                        return `<span class="${colorClass} text-xs font-semibold px-2 py-1 rounded-full">${cat.charAt(0).toUpperCase() + cat.slice(1)}</span>`;
                    }).join(' ');

                    if (modalModalityName) modalModalityName.textContent = currentModalityName;
                    
                    // Populate static details
                    if (modalityStaticDetails) {
                        modalityStaticDetails.innerHTML = `
                            <div class="text-6xl mb-2">${modalityIcon}</div>
                            <p class="text-lg font-semibold mb-2">Tipo: ${modalityType}</p>
                            <p class="text-lg font-semibold mb-2">Atletas: ${modalityAthletes || 'N√£o especificado'}</p>
                            <div class="flex justify-center space-x-2">${modalityCategories}</div>
                        `;
                    }

                    // Clear previous AI results and description
                    if (modalityAiResult) modalityAiResult.classList.add('hidden');
                    if (modalityAiLoading) modalityAiLoading.textContent = '';
                    if (modalityAiContent) modalityAiContent.innerHTML = '';
                    if (modalityDescriptionArea) modalityDescriptionArea.classList.remove('hidden'); // Ensure description area is visible
                    if (modalityDescriptionLoading) modalityDescriptionLoading.textContent = '';
                    if (modalityDescriptionContent) modalityDescriptionContent.innerHTML = '';

                    // Generate and display description
                    await generateModalityDescription(currentModalityName);

                    if (modalityAiModal) modalityAiModal.classList.add('open');
                });
            }

            if (closeModalBtn) { // Null check
                closeModalBtn.addEventListener('click', () => {
                    if (modalityAiModal) modalityAiModal.classList.remove('open');
                });
            }

            if (modalityAiModal) { // Null check
                modalityAiModal.addEventListener('click', (e) => {
                    if (e.target === modalityAiModal) { // Close if clicked outside content
                        modalityAiModal.classList.remove('open');
                    }
                });
            }

            // New function for generating modality description
            async function generateModalityDescription(modalityName) {
                if (modalityDescriptionLoading) modalityDescriptionLoading.textContent = `Gerando descri√ß√£o para ${modalityName}... Por favor, aguarde.`;
                if (modalityDescriptionContent) modalityDescriptionContent.innerHTML = '';

                const prompt = `Forne√ßa uma descri√ß√£o concisa e envolvente da modalidade esportiva ${modalityName}, incluindo sua ess√™ncia, objetivo principal e o que a torna interessante, para um p√∫blico geral em um contexto de jogos estudantis.`;
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData}`);
                    }
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        if (modalityDescriptionContent) modalityDescriptionContent.innerHTML = text.replace(/\n/g, '<br>');
                        if (modalityDescriptionLoading) modalityDescriptionLoading.textContent = '';
                    } else {
                        if (modalityDescriptionLoading) modalityDescriptionLoading.textContent = 'N√£o foi poss√≠vel gerar a descri√ß√£o. Tente novamente.';
                    }
                } catch (error) {
                    console.error('Erro ao chamar a API Gemini para descri√ß√£o da modalidade:', error);
                    if (modalityDescriptionLoading) modalityDescriptionLoading.textContent = 'Erro ao gerar descri√ß√£o. Verifique sua conex√£o ou tente mais tarde.';
                }
            }


            if (generateTrainingPlanBtn) { // Null check
                generateTrainingPlanBtn.addEventListener('click', async () => {
                    if (modalityAiResult) modalityAiResult.classList.remove('hidden');
                    if (modalityAiLoading) modalityAiLoading.textContent = `Gerando plano de treinamento para ${currentModalityName}... Por favor, aguarde.`;
                    if (modalityAiContent) modalityAiContent.innerHTML = '';

                    const prompt = `Elabore um plano de treinamento b√°sico para atletas escolares de ${currentModalityName} que participar√£o dos Jogos Estudantis Vilelenses. O plano deve focar em aspectos gerais de prepara√ß√£o f√≠sica, t√©cnica e t√°tica, adequado para um per√≠odo de 4 semanas. Inclua aquecimento, exerc√≠cios principais e alongamento.`;
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (modalityAiContent) modalityAiContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (modalityAiLoading) modalityAiLoading.textContent = '';
                        } else {
                            if (modalityAiLoading) modalityAiLoading.textContent = `N√£o foi poss√≠vel gerar o plano de treinamento. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para plano de treinamento:', error);
                        if (modalityAiLoading) modalityAiLoading.textContent = 'Erro ao gerar plano. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }

            if (viewRulesHistoryBtn) { // Null check
                viewRulesHistoryBtn.addEventListener('click', async () => {
                    if (modalityAiResult) modalityAiResult.classList.remove('hidden');
                    if (modalityAiLoading) modalityAiLoading.textContent = `Buscando aspectos de regras e hist√≥rico para ${currentModalityName}... Por favor, aguarde.`;
                    if (modalityAiContent) modalityAiContent.innerHTML = '';

                    const prompt = `Forne√ßa aspectos importantes das regras e um breve hist√≥rico da modalidade ${currentModalityName}, focando em informa√ß√µes relevantes para um contexto de jogos estudantis.`;
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBHxP40DZ9X2prMB_VeQWFLNby8J2BCKCI"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = response.ok ? await response.json() : await response.text(); // Handle non-JSON response
                        if (response.ok && result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            if (modalityAiContent) modalityAiContent.innerHTML = text.replace(/\n/g, '<br>');
                            if (modalityAiLoading) modalityAiLoading.textContent = '';
                        } else {
                            if (modalityAiLoading) modalityAiLoading.textContent = `N√£o foi poss√≠vel buscar as informa√ß√µes. Erro: ${typeof result === 'string' ? result : 'Resposta inesperada.'}`;
                        }
                    } catch (error) {
                        console.error('Erro ao chamar a API Gemini para regras/hist√≥rico:', error);
                        if (modalityAiLoading) modalityAiLoading.textContent = 'Erro ao buscar informa√ß√µes. Verifique sua conex√£o ou tente mais tarde.';
                    }
                });
            }


            // --- INITIAL RENDER ---
            renderModalities();
        });
    </script>
</body>
</html>
